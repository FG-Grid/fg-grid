var e,t;e="undefined"!=typeof self?self:this,t=function(){const e={version:"0.7.18",isTouchDevice:"ontouchstart"in window,gridIdSeed:0,gridsMap:new Map,get(e){return this.gridsMap.get(e)},capitalizeFirstLetter:e=>e.charAt(0).toUpperCase()+e.slice(1),deepClone(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map((t=>e.deepClone(t)));const o={};for(let r in t)t.hasOwnProperty(r)&&(o[r]=e.deepClone(t[r]));return o},getTranslateY(e){const t=window.getComputedStyle(e).transform;if(!t||"none"===t)return 0;const o=t.match(/matrix.*\((.+)\)/);if(!o)return 0;const r=o[1].split(", ").map(parseFloat);return 6===r.length?r[5]:0},typeOf(e){if(null===e)return"null";const t=typeof e;if("undefined"===t||"string"===t||"number"===t||"boolean"===t)return t;const o=Object.prototype.toString.call(e);if(void 0!==e.length&&"function"!=typeof e)return"array";switch(o){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}return"function"===t?"function":"object"===t?"object":void 0},div:(t=[],o={})=>e.newElement("div",t,o),span:(t=[],o={})=>e.newElement("span",t,o),input:(t=[],o={})=>e.newElement("input",t,o),newElement(e,t,o={}){const r=document.createElement(e);Array.isArray(t)?r.classList.add(...t):"string"==typeof t&&r.classList.add(t);for(let e in o)r.style[e]=o[e];return r}};return window.Fancy=window.Fancy||e,Fancy.debounce=(e,t)=>{let o;return function(...r){clearTimeout(o),o=setTimeout((()=>{e.apply(this,r)}),t)}},Fancy.svg={chevronRight:['<svg viewBox="0 0 16 16" style="shape-rendering: geometricprecision;">','<path fill-rule="evenodd" fill="currentColor" d="M5.054 4.524a1.04 1.04 0 0 1 1.47-1.47l4.211 4.211a1.04 1.04 0 0 1 0 1.47l-4.21 4.21a1.04 1.04 0 0 1-1.47-1.47L8.53 8 5.054 4.524z"></path>',"</svg>"].join(""),group:['<svg viewBox="0 0 16 16" style="shape-rendering: geometricprecision;">','<path fill-rule="evenodd" fill="currentColor" d="M1 3.006C1 1.898 1.897 1 3.006 1h9.988C14.102 1 15 1.897 15 3.006v9.988A2.005 2.005 0 0 1 12.994 15H3.006A2.005 2.005 0 0 1 1 12.994V3.006zm2 .99v8.009c0 .54.446.995.995.995h8.01c.54 0 .995-.446.995-.995v-8.01c0-.54-.446-.995-.995-.995h-8.01C3.455 3 3 3.446 3 3.995zM7 6c0-.552.444-1 1-1h3c.552 0 1 .444 1 1 0 .552-.444 1-1 1H8c-.552 0-1-.444-1-1zm0 4c0-.552.444-1 1-1h3c.552 0 1 .444 1 1 0 .552-.444 1-1 1H8c-.552 0-1-.444-1-1zM4 6c0-.552.444-1 1-1 .552 0 1 .444 1 1 0 .552-.444 1-1 1-.552 0-1-.444-1-1zm0 4c0-.552.444-1 1-1 .552 0 1 .444 1 1 0 .552-.444 1-1 1-.552 0-1-.444-1-1z"></path>',"</svg>"].join(""),groupCellDrag:['<svg viewBox="0 0 16 16" style="shape-rendering: geometricprecision;">','<path fill-rule="evenodd" fill="currentColor" d="M5 3.505C5 3.226 5.214 3 5.505 3h.99c.279 0 .505.214.505.505v.99A.497.497 0 0 1 6.495 5h-.99A.497.497 0 0 1 5 4.495v-.99zm4 0C9 3.226 9.214 3 9.505 3h.99c.279 0 .505.214.505.505v.99a.497.497 0 0 1-.505.505h-.99A.497.497 0 0 1 9 4.495v-.99zm-4 4C5 7.226 5.214 7 5.505 7h.99c.279 0 .505.214.505.505v.99A.497.497 0 0 1 6.495 9h-.99A.497.497 0 0 1 5 8.495v-.99zm4 0C9 7.226 9.214 7 9.505 7h.99c.279 0 .505.214.505.505v.99a.497.497 0 0 1-.505.505h-.99A.497.497 0 0 1 9 8.495v-.99zm-4 4c0-.279.214-.505.505-.505h.99c.279 0 .505.214.505.505v.99a.497.497 0 0 1-.505.505h-.99A.497.497 0 0 1 5 12.495v-.99zm4 0c0-.279.214-.505.505-.505h.99c.279 0 .505.214.505.505v.99a.497.497 0 0 1-.505.505h-.99A.497.497 0 0 1 9 12.495v-.99z"></path>',"</svg>"].join(""),remove:['<svg viewBox="0 0 16 16" style="shape-rendering: geometricprecision;">','<path fill-rule="evenodd" fill="currentColor" d="M3.71428571,7 C3.32,7 3,7.224 3,7.5 L3,8.5 C3,8.776 3.32,9 3.71428571,9 L12.2857143,9 C12.68,9 13,8.776 13,8.5 L13,7.5 C13,7.224 12.68,7 12.2857143,7 L3.71428571,7 Z"></path>',"</svg>"].join(""),block:['<svg viewBox="0 0 16 16" style="shape-rendering: geometricprecision;">','<path fill-rule="evenodd" fill="currentColor" d="M3.617 4.677A5.48 5.48 0 0 0 2.5 8 5.5 5.5 0 0 0 8 13.5a5.48 5.48 0 0 0 3.323-1.117zm1.06-1.06 7.706 7.706A5.48 5.48 0 0 0 13.5 8 5.5 5.5 0 0 0 8 2.5a5.48 5.48 0 0 0-3.323 1.117M1 8a7 7 0 1 1 14 0A7 7 0 0 1 1 8 Z"></path>"',"</svg>"].join(""),menu:['<svg viewBox="0 0 28 28">','<path d="M5.5 8a1 1 0 1 1 0-2h17a1 1 0 0 1 0 2h-17Zm0 7a1 1 0 0 1 0-2h17a1 1 0 0 1 0 2h-17Zm0 7a1 1 0 0 1 0-2h17a1 1 0 0 1 0 2h-17Z"></path>',"</svg>"].join(""),sortAsc:['<svg viewBox="0 0 16 16">','<path d="M12.78 6.47a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69a.75.75 0 0 1-1.5 0V4.56L4.28 7.53a.75.75 0 1 1-1.06-1.06l4.25-4.25a.75.75 0 0 1 1.06 0l4.25 4.25Z"></path>',"</svg>"].join(""),sortDesc:['<svg viewBox="0 0 16 16">','<path d="M3.22 9.53a.75.75 0 0 1 1.06-1.06l2.97 2.97V2.75a.75.75 0 0 1 1.5 0v8.69l2.97-2.97a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L3.22 9.53Z"></path>',"</svg>"].join(""),filter:['<svg viewBox="0 0 20 20">','<path d="M7.5 7.75a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM5.11 6A2.5 2.5 0 0 1 9.9 6h6.36a.75.75 0 0 1 0 1.5H9.89a2.5 2.5 0 0 1-4.78 0H3.75a.75.75 0 0 1 0-1.5zm7.39 8.25a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm2.39-1.75a2.5 2.5 0 0 0-4.78 0H3.75a.75.75 0 0 0 0 1.5h6.36a2.5 2.5 0 0 0 4.78 0h1.36a.75.75 0 0 0 0-1.5z"></path>',"</svg>"].join("")},Fancy.cls={HIDDEN:"fg-hidden",GRID:"fg-grid",TOUCH:"fg-touch",EDITING:"fg-editing",HEADER:"fg-header",HEADER_INNER:"fg-header-inner",HEADER_INNER_CONTAINER:"fg-header-inner-container",HEADER_CELL:"fg-header-cell",HEADER_CELL_SORTABLE:"fg-header-cell-sortable",HEADER_CELL_NOT_RESIZABLE:"fg-header-cell-not-resizable",HEADER_CELL_LABEL:"fg-header-cell-label",HEADER_CELL_TEXT:"fg-header-cell-text",HEADER_FILTER_EL:"fg-header-filter-el",HEADER_CELL_RESIZE:"fg-header-cell-resize",HEADER_CELL_MENU:"fg-header-cell-menu",HEADER_CELL_SELECTION:"fg-header-cell-selection",BODY:"fg-body",BODY_INNER:"fg-body-inner",BODY_INNER_CONTAINER:"fg-body-inner-container",EDITORS_CONTAINER:"fg-editors-container",COLUMN_RESIZING:"fg-column-resizing",COLUMN_DRAGGING:"fg-column-dragging",FAKE_COLUMN_CELL_DRAGGING:"fg-fake-column-cell-dragging",FAKE_COLUMN_CELL_DRAGGING_ALLOW:"fg-fake-column-cell-dragging-allow",FAKE_COLUMN_CELL_DRAGGING_DENY:"fg-fake-column-cell-dragging-deny",COLUMNS_MENU:"fg-columns-menu",COLUMNS_MENU_ITEM:"fg-columns-menu-item",COLUMNS_MENU_ITEM_TEXT:"fg-columns-menu-item-text",CELL:"fg-cell",CELL_VALUE:"fg-cell-value",ANIMATE_CELLS_POSITION:"fg-animate-cells-position",GRID_CELLS_RIGHT_BORDER:"fg-enabled-cell-right-border",CELL_BOOLEAN:"fg-cell-boolean",CELL_ORDER:"fg-cell-order",CELL_WRAPPER:"fg-cell-wrapper",CELL_SELECTION:"fg-cell-selection",CELL_SELECTED:"fg-cell-selected",ACTIVE_CELL:"fg-cell-active",ACTIVE_CELL_ROW:"fg-cell-active-row",ROW:"fg-row",ROW_ODD:"fg-row-odd",ROW_EVEN:"fg-row-even",ROW_GROUP:"fg-row-group",ROW_SELECTED:"fg-row-selected",ROW_GROUP_VALUE_CELL:"fg-row-group-value-cell",ROW_GROUP_CELL:"fg-row-group-cell",ROW_GROUP_CELL_SELECTION:"fg-row-group-cell-selection",ROW_GROUP_CELL_VALUE:"fg-row-group-cell-value",ROW_GROUP_CELL_AMOUNT:"fg-row-group-cell-amount",ROW_GROUP_CELL_EXPANDER:"fg-row-group-cell-expander",ROW_GROUP_EXPANDED_CELL:"fg-row-group-cell-expanded",ROW_ANIMATION:"fg-row-animation",ROW_HOVER:"fg-row-hover",ROW_GROUP_BAR:"fg-row-group-bar",ROW_GROUP_BAR_EMPTY_TEXT:"fg-row-group-bar-empty-text",ROW_GROUP_BAR_ITEM_CONTAINER:"fg-row-group-bar-item-container",ROW_GROUP_BAR_ITEM:"fg-row-group-bar-item",ROW_GROUP_BAR_ITEM_TEXT:"fg-row-group-bar-item-text",ROW_GROUP_BAR_ITEM_ACTIVE:"fg-row-group-bar-item-active",FILTER_BAR:"fg-filter-bar",FILTER_BAR_CELL:"fg-filter-bar-cell",FILTER_BAR_INNER:"fg-filter-bar-inner",FILTER_BAR_INNER_CONTAINER:"fg-filter-bar-inner-container",FILTER_INDICATOR_CONTAINER:"fg-filter-indicator-container",FILTER_FIELD:"fg-filter-field",FILTER_FIELD_INPUT:"fg-filter-field-input",FILTER_FIELD_TEXT:"fg-filter-field-text",FILTER_FIELD_SIGN:"fg-filter-field-sign",FILTER_FIELD_LIST:"fg-filter-field-list",FILTER_FIELD_LIST_ITEM:"fg-filter-field-list-item",FILTER_FIELD_LIST_ITEM_TEXT:"fg-filter-field-list-item-text",SORT_ORDER:"fg-sort-order",SORT_ASC:"fg-sort-asc",SORT_DESC:"fg-sort-desc",SORT_INDICATOR_CONTAINER:"fg-sort-indicator-container",BODY_VERTICAL_SCROLL:"fg-body-vertical-scroll",BODY_VERTICAL_SCROLL_CONTAINER:"fg-body-vertical-scroll-container",BODY_VERTICAL_SCROLL_SIZE:"fg-body-vertical-scroll-size",BODY_HORIZONTAL_SCROLL:"fg-body-horizontal-scroll",BODY_HORIZONTAL_SCROLL_CONTAINER:"fg-body-horizontal-scroll-container",BODY_HORIZONTAL_SCROLL_SIZE:"fg-body-horizontal-scroll-size",SCROLLBAR_INVISIBLE:"fg-scrollbar-invisible",INPUT_CHECKBOX:"fg-input-checkbox",FIELD:"fg-field",FIELD_INPUT:"fg-field-input",STRING_FIELD:"fg-string-field",STRING_FIELD_INPUT:"fg-string-field-input",NUMBER_FIELD:"fg-number-field",NUMBER_FIELD_INPUT:"fg-number-field-input",SVG_ITEM:"fg-svg-item",SVG_CHEVRON_RIGHT:"fg-svg-chevron-right",SVG_GROUP:"fg-svg-group",SVG_DRAG:"fg-svg-drag",SVG_REMOVE:"fg-svg-remove",SVG_BLOCK:"fg-svg-block"},Fancy.key={BACKSPACE:8,TAB:9,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_DOT:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,WHEEL_SCALE:120,DOT:190},Fancy.Key={isNum(e){const t=Fancy.key;switch(e){case t.ZERO:case t.ONE:case t.TWO:case t.THREE:case t.FOUR:case t.FIVE:case t.SIX:case t.SEVEN:case t.EIGHT:case t.NINE:case t.NUM_ZERO:case t.NUM_ONE:case t.NUM_TWO:case t.NUM_THREE:case t.NUM_FOUR:case t.NUM_FIVE:case t.NUM_SIX:case t.NUM_SEVEN:case t.NUM_EIGHT:case t.NUM_NINE:return!0;default:return!1}},isNumControl(e,t){const o=Fancy.key;if(Fancy.Key.isNum(e))return!0;if(t.shiftKey&&187===e)return!0;switch(e){case o.NUM_PLUS:case 189:case o.NUM_MINUS:case o.NUM_DOT:case o.BACKSPACE:case o.DELETE:case o.TAB:case o.ENTER:case o.RETURN:case o.SHIFT:case o.CTRL:case o.ALT:case o.ESC:case o.END:case o.HOME:case o.LEFT:case o.UP:case o.RIGHT:case o.DOWN:case o.INSERT:case o.DOT:return!0;default:return!1}}},Fancy.render={boolean(e){const{column:t,value:o,cell:r}=e;if(""===o)return;const l=document.createElement("input");l.setAttribute("type","checkbox"),l.checked=o,l.addEventListener("click",(e=>{!t.editable&&e.preventDefault()})),l.addEventListener("change",(e=>{t.onCheckBoxChange?.(e,l.checked)})),r.classList.add(Fancy.cls.CELL_BOOLEAN),r.appendChild(l)},order(e){const{cell:t,rowIndex:o}=e;if(!t)return Number(o)+1;t.classList.add(Fancy.cls.CELL_ORDER),t.innerHTML=o+1}},Fancy.format={CURRENCY_REGIONS:{USD:"en-US",EUR:"de",GBP:"en-gb",JPY:"jp",CNY:"zh-cn"},currency(e){const t=e.value,o=e.minDecimal||0,r=e.maxDecimal||o||0,l=e.currency||"USD";let n="en-US";return isNaN(t)||""===t||null===t?"":(e.region?n=e.region:Fancy.format.CURRENCY_REGIONS[e.currency]&&(n=Fancy.format.CURRENCY_REGIONS[e.currency]),new Intl.NumberFormat(n,{style:"currency",currency:l,minimumFractionDigits:o,maximumFractionDigits:r}).format(t))}},Fancy.copyText=e=>{if(navigator.clipboard)navigator.clipboard.writeText(e).catch((e=>console.error("Error copying: ",e)));else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}},Fancy.Store=class{data=[];sortedData=void 0;filteredData=void 0;sorters=[];filters=[];rowGroups=[];rowGroupExpanded=[];aggregations=[];idRowIndexesMap=null;idItemMap=null;selectedItemsMap=null;selectedRowGroupsChildren=null;idSeed=0;prevAction="";constructor({data:e,rowGroups:t,rowGroupExpanded:o,aggregations:r,defaultRowGroupSort:l}){const n=this;n.prevAction="",n.data=e||[],n.rowGroups=t||[],n.rowGroupExpanded=o||[],n.aggregations=r||[],n.defaultRowGroupSort=l||[],n.selectedItemsMap=new Map,n.selectedRowGroupsChildren={},n.groupDetails={},n.data.length&&n.rowGroups.length?(n.lightSetIds(),n.rowGroupData(),n.setIndexAndItemsMaps()):n.setIds()}setData(e){const t=this;t.sortedData=void 0,t.filteredData=void 0,t.data=e,t.selectedItemsMap=new Map,t.selectedRowGroupsChildren={},t.data.length&&t.rowGroups.length?(t.lightSetIds(),t.filters.length&&t.reFilter(),t.rowGroupData(),t.setIndexAndItemsMaps()):(t.setIds(),t.filters.length&&t.reFilter(!1),t.sorters.length&&t.reSort())}lightSetIds(){const e=this;e.idSeed=0,e.data.forEach((t=>{void 0===t.id?t.id=e.generateId():"number"==typeof t.id&&(t.id=String(t.id))}))}setIndexAndItemsMaps(){const e=this;e.idItemMap||(e.idItemMap=new Map),e.updateIndexes()}updateIndexes(){const e=this,t=e.displayedData||e.data;e.$isOriginalDataIndexesSet||e.data.forEach(((e,t)=>{e.originalDataRowIndex=t})),e.idRowIndexesMap=new Map,t.forEach(((t,o)=>{e.idRowIndexesMap.set(t.id,o),e.idItemMap.set(t.id,t),t.rowIndex=o,t.originalRowIndex=o}))}setIds(){const e=this;e.idRowIndexesMap=new Map,e.idItemMap=new Map,e.idSeed=0,e.data.forEach(((t,o)=>{void 0===t.id&&(t.id=e.generateId(),t.originalRowIndex=o),e.idRowIndexesMap.set(String(t.id),o),e.idItemMap.set(String(t.id),t)}))}generateId(){return"id-"+this.idSeed++}getDataTotal(){return this.data.length}getDisplayedDataTotal(){const{sorters:e,filters:t,rowGroups:o}=this;return e.length||t.length||o.length?this.displayedData?.length||0:this.getDataTotal()}getItemByRowIndex(e){const t=this,{sorters:o,filters:r,rowGroups:l}=t;let n;return n=o.length||r.length||l.length?t.displayedData[e]:t.data[e],n}memorizePrevRowIndexesMap(){this.prevIdRowIndexesMap=this.idRowIndexesMap}getPrevVisibleRowIndex(e){const t=this.displayedData||this.data;for(let o=e-1;o>-1;o--)if(!0!==t[o].$isGroupRow)return o}getNextVisibleRowIndex(e){const t=this,o=t.getDisplayedDataTotal(),r=t.displayedData||t.data;for(let t=e+1;t<o;t++)if(!0!==r[t].$isGroupRow)return t}},(()=>{const e={reSort(){const e=this;let t;t=e.filteredData?e.filteredData.slice():e.data.slice(),e.sorters.forEach((o=>{t=e.sortData(t,o.column,o.dir)})),e.sortedData=t,e.idRowIndexesMap=new Map,e.sortedData.forEach(((t,o)=>{e.idRowIndexesMap.set(t.id,o),t.rowIndex=o})),e.displayedData=e.sortedData},sort(e,t="ASC",o){const r=this;let l;switch(l="sort"===r.prevAction&&r.sortedData?r.sortedData.slice():r.filteredData?r.filteredData.slice():r.data.slice(),r.prevIdRowIndexesMap||(r.prevIdRowIndexesMap=r.idRowIndexesMap),r.sorters=o?r.sorters.filter((t=>t.column.id!==e.id)):[],r.sorters.push({column:e,dir:t}),t){case"ASC":case"DESC":r.rowGroups.length?r.sortedData=r.filters.length?r.sortGroupDataForFiltering(e,t):r.sortGroupData(e,t):r.sortedData=r.sortData(l,e,t)}r.idRowIndexesMap=new Map,r.sortedData.forEach(((e,t)=>{r.idRowIndexesMap.set(e.id,t),e.rowIndex=t})),r.displayedData=r.sortedData,r.prevAction="sort"},sortGroupData(e,t){const o=this,r=o.displayedData.slice();for(const l in o.expandedGroupsWithDataChildren){if(o.isParentCollapsed(l))continue;const n=o.groupsChildren[l].slice(),s=o.groupDetails[l],i=o.idRowIndexesMap.get(s.id);let a=n;o.sorters.length?o.sorters.forEach((e=>{a=o.sortData(a,e.column,e.dir)})):a=o.sortData(n,e,t),r.splice(i+1,a.length,...a)}return r},sortGroupDataForFiltering(e,t){const o=this,r=o.displayedData.slice();for(const l in o.expandedGroupsWithDataChildrenForFiltering){if(o.isParentCollapsed(l))continue;const n=o.groupsChildrenForFiltering[l].slice(),s=o.groupDetailsForFiltering[l],i=o.idRowIndexesMap.get(s.id);let a=n;o.sorters.length?o.sorters.forEach((e=>{a=o.sortData(a,e.column,e.dir)})):a=o.sortData(n,e,t),r.splice(i+1,a.length,...a)}return r},sortPieceOfData(e){const t=this;return t.sorters.forEach((o=>{e=t.sortData(e,o.column,o.dir)})),e},sortData(e,t,o){let r=[];switch(o){case"ASC":switch(t.type){case"number":r=e.sort(((e,o)=>(t.getter?(e=t.getter({item:e}),o=t.getter({item:o})):(e=e[t.index],o=o[t.index]),null===e&&(e=Number.MIN_SAFE_INTEGER),null===o&&(o=Number.MIN_SAFE_INTEGER),e-o)));break;case"string":r=e.sort(((e,o)=>(t.getter?(e=t.getter({item:e})||"",o=t.getter({item:o})||""):(e=e[t.index]||"",o=o[t.index]||""),e.localeCompare||console.error(`${e} is not a string`),e.localeCompare(o))));break;case"boolean":r=e.sort(((e,o)=>(t.getter?(e=t.getter({item:e})||!1,o=t.getter({item:o})||!1):(e=e[t.index]||!1,o=o[t.index]||!1),e===o?0:e?1:-1)))}break;case"DESC":switch(t.type){case"number":r=e.sort(((e,o)=>(t.getter?(e=t.getter({item:e}),o=t.getter({item:o})):(e=e[t.index],o=o[t.index]),null===e&&(e=Number.MIN_SAFE_INTEGER),null===o&&(o=Number.MIN_SAFE_INTEGER),o-e)));break;case"string":r=e.sort(((e,o)=>(t.getter?(e=t.getter({item:e})||"",o=t.getter({item:o})||""):(e=e[t.index]||"",o=o[t.index]||""),o.localeCompare(e))));break;case"boolean":r=e.sort(((e,o)=>(t.getter?(e=t.getter({item:e})||!1,o=t.getter({item:o})||!1):(e=e[t.index]||!1,o=o[t.index]||!1),e===o?0:e?-1:1)))}}return r},clearSort(e,t){const o=this;if(o.sortedData=[],o.sorters=e&&t?o.sorters.filter((t=>t.column.id!==e.id)):[],o.rowGroups.length||(o.idRowIndexesMap=new Map),o.sorters.length)o.rowGroups.length?(o.sortedData=o.filters.length?o.sortGroupDataForFiltering():o.sortGroupData(),o.idRowIndexesMap=new Map,o.sortedData.forEach(((e,t)=>{o.idRowIndexesMap.set(e.id,t),e.rowIndex=t})),o.displayedData=o.sortedData,o.prevAction="sort"):o.reSort();else if(o.filters.length)o.rowGroups.length?(o.rowGroupDataForFiltering(),o.sortGroupsForFiltering(),o.generateDisplayedGroupedDataForFiltering(!0),o.updateIndexes(),o.prevAction="filter"):(o.filteredData||o.reFilter(!1),o.filteredData.forEach(((e,t)=>{o.idRowIndexesMap.set(e.id,t),e.rowIndex=t})),o.displayedData=o.filteredData);else if(o.rowGroups.length){for(const e in o.expandedGroupsWithDataChildren)o.groupsChildren[e].forEach((e=>{o.idRowIndexesMap.set(e.id,e.originalRowIndex),e.rowIndex=e.originalRowIndex}));o.sortGroups(),o.simpleReGenerateDisplayedGroupedData()}else o.data.forEach(((e,t)=>{o.idRowIndexesMap.set(e.id,t),e.rowIndex=t}));0===o.sorters.length&&delete o.sortedData},isParentCollapsed(e){const t=this,o=e.split("/");let r=o.length-1;for(let e=0;e<r;e++)if(o.pop(),!t.expandedGroups[o.join("/")])return!0;return!1}};Object.assign(Fancy.Store.prototype,e)})(),(()=>{const e={clearFilter(e,t){const o=this;o.filters=o.filters.filter((t=>t.column.id!==e.id)),delete o.prevFilterColumn,o.reFilter(!1),o.reSort()},clearFilterForGrouping(e,t){const o=this,r=o.data.slice();o.filters=o.filters.filter((t=>t.column.id!==e.id)),delete o.prevFilterColumn,o.filteredData=o.filters.reduce(((e,t)=>o.filterData(e,t.column,t.value,t.sign)),r),o.rowGroupDataForFiltering(),o.sortGroupsForFiltering(),o.generateDisplayedGroupedDataForFiltering(),o.updateIndexes(),0===o.filters.length&&delete o.filteredData,o.prevAction="filter"},reFilter(e=!0){const t=this;let o;o=e&&"sort"===t.prevAction&&t.sortedData?t.sortedData.slice():t.data.slice(),t.filteredData=t.filters.reduce(((e,o)=>t.filterData(e,o.column,o.value,o.sign)),o),t.displayedData=t.filteredData,t.updateIndexMapAfterFilter(),0===t.filters.length&&delete t.filteredData,t.prevAction="filter"},filter(e,t,o="="){const r=this;let l,n=!1;if("sort"===r.prevAction&&r.sortedData?l=r.sortedData.slice():"filter"===r.prevAction&&r.prevFilterColumn?.id!==e.id&&r.filteredData?l=r.filteredData.slice():"filter"===r.prevAction&&r.prevFilterColumn?.id===e.id?n=!0:l=r.data.slice(),r.filters=r.filters.filter((t=>t.column.id!==e.id)),null!==t&&r.filters.push({column:e,value:t,sign:o}),n)return r.reFilter(),void r.reSort();r.filteredData=r.filterData(l,e,t,o),r.displayedData=r.filteredData,r.updateIndexMapAfterFilter(),r.prevAction="filter",r.prevFilterColumn=e},filterForRowGrouping(e,t,o="="){const r=this,l=r.data.slice();r.filters=r.filters.filter((t=>t.column.id!==e.id)),null!==t&&r.filters.push({column:e,value:t,sign:o}),r.filteredData=r.filters.reduce(((e,t)=>r.filterData(e,t.column,t.value,t.sign)),l),r.rowGroupDataForFiltering(),r.sortGroupsForFiltering(),r.generateDisplayedGroupedDataForFiltering(),r.updateIndexes(),r.prevAction="filter",r.prevFilterColumn=e},updateIndexMapAfterFilter(){const e=this;e.memorizePrevRowIndexesMap(),e.idRowIndexesMap=new Map,e.filteredData.forEach(((t,o)=>{e.idRowIndexesMap.set(t.id,o),t.rowIndex=o}))},filterData(e,t,o,r){let l=[];o=String(o).toLocaleLowerCase();const n=e=>{let o;return o=t.getter?t.getter({item:e,column:t}):e[t.index],o};switch(r){case"=":l=e.filter((e=>String(n(e)).toLocaleLowerCase().includes(o)));break;case"!=":l=e.filter((e=>!String(n(e)).toLocaleLowerCase().includes(o)));break;case"==":l=e.filter((e=>String(n(e)).toLocaleLowerCase()===o));break;case"!==":l=e.filter((e=>String(n(e)).toLocaleLowerCase()!==o));break;case">":l=e.filter((e=>n(e)>o));break;case"<":l=e.filter((e=>n(e)<o));break;case"_a":l=e.filter((e=>String(n(e)).toLocaleLowerCase().startsWith(o)));break;case"a_":l=e.filter((e=>String(n(e)).toLocaleLowerCase().endsWith(o)));break;case"regex":l=e.filter((e=>{const t=String(n(e)).toLocaleLowerCase();return new RegExp(o).test(t)}));break;case"empty":l=e.filter((e=>{switch(n(e)){case void 0:case null:case"":return!0}return!1}));break;case"!empty":l=e.filter((e=>{switch(n(e)){case void 0:case null:case"":return!1}return!0}));break;case"+":l=e.filter((e=>n(e)>=0));break;case"-":l=e.filter((e=>n(e)<0))}return l}};Object.assign(Fancy.Store.prototype,e)})(),(()=>{const e={rowGroupData(){const e=this;e.set$rowGroupValue(),e.setExpandedGroups(),e.generateGroupsInfo(),e.sortGroups(),e.generateDisplayedGroupedData()},rowGroupDataForFiltering(){this.generateGroupsInfoForFiltering()},generateDisplayedGroupedData(){const e=this,t=e.getSortedDisplayedGroups();let o=[];t.forEach((t=>{const r=e.groupsChildren[t],l=e.groupDetails[t],n=e.expandedGroups[t]||!1;o.push(l),!l.$hasChildrenGroups&&n&&(o=o.concat(r))})),e.displayedData=o},simpleReGenerateDisplayedGroupedData(){const e=this,t=e.displayedData.slice();for(const o in e.expandedGroupsWithDataChildren){if(e.isParentCollapsed(o))continue;const r=e.groupsChildren[o].slice(),l=e.groupDetails[o],n=e.idRowIndexesMap.get(l.id);t.splice(n+1,r.length,...r)}e.displayedData=t},generateDisplayedGroupedDataForFiltering(e=!1){const t=this;let o=[],r=[];e?r=t.getGroupDataForFiltering():(o=t.getSortedDisplayedGroupsForFiltering(),o.forEach((e=>{const o=t.groupsChildrenForFiltering[e],l=t.groupDetailsForFiltering[e],n=t.expandedGroups[e]||!1;r.push(l),!l.$hasChildrenGroups&&n&&(r=r.concat(o))}))),t.displayedData=r},generateGroupsInfo(e,t){const o=this,r={};let l=!0;if(void 0===e&&(o.groupsChildren=o.groupsChildren||Object.groupBy(o.data,(e=>e.$rowGroupValue)),e=Object.keys(o.groupsChildren),t=o.rowGroups.length-1,l=!1,o.groupDetails={},o.levelsWithGroups=[[{root:[]}]],o.expandedGroupsWithDataChildren={}),e.forEach((e=>{const n=e.split("/"),s=n.pop();let i="root";0!==t&&(i=n.join("/"),r[i]=!0);const a=n.join("/"),d=o.expandedGroups[e]||!1;o.groupsChildren[a]=o.groupsChildren[a]||[],o.levelsWithGroups[t]=o.levelsWithGroups[t]||[{}],o.levelsWithGroups[t][0][i]=o.levelsWithGroups[t][0][i]||[],o.levelsWithGroups[t][0][i].push(e);const c={$rowGroupValue:e,$rowDisplayGroupValue:s,$groupLevel:t,$isGroupRow:!0,$hasChildrenGroups:l,id:o.generateId(),childrenAmount:o.groupsChildren[e].length,expanded:d,$agValues:{}};l?(o.aggregations.forEach((t=>{const r=o.groupsChildren[e].map((e=>e.$agValues[t.index]));c.$agValues[t.index]=o.getAggregationResult(t,r)})),c.amount=o.groupsChildren[e].reduce(((e,t)=>e+t.amount),0)):(o.aggregations.forEach((t=>{const r=o.groupsChildren[e].map((e=>e[t.index]));c.$agValues[t.index]=o.getAggregationResult(t,r)})),c.amount=c.childrenAmount,c.expanded&&(o.expandedGroupsWithDataChildren[e]=!0)),o.groupDetails[e]=c,0!==t&&o.groupsChildren[a].push(c)})),0!==t){const e=Object.keys(r);o.generateGroupsInfo(e,t-1)}},generateGroupsInfoForFiltering(e,t){const o=this,r={};let l=!0;if(void 0===e&&(o.groupsChildrenForFiltering=Object.groupBy(o.filteredData,(e=>e.$rowGroupValue)),e=Object.keys(o.groupsChildrenForFiltering),t=o.rowGroups.length-1,l=!1,o.groupDetailsForFiltering={},o.levelsWithGroupsForFiltering=[],o.expandedGroupsWithDataChildrenForFiltering={}),e.forEach((e=>{const n=o.groupDetails[e],s=e.split("/"),i=s.pop();let a="root";0!==t&&(a=s.join("/"),r[a]=!0);const d=s.join("/"),c=o.expandedGroups[e]||!1;o.groupsChildrenForFiltering[d]=o.groupsChildrenForFiltering[d]||[],o.levelsWithGroupsForFiltering[t]=o.levelsWithGroupsForFiltering[t]||[{}],o.levelsWithGroupsForFiltering[t][0][a]=o.levelsWithGroupsForFiltering[t][0][a]||[],o.levelsWithGroupsForFiltering[t][0][a].push(e),n||console.error(`groupDetails does not contain ${e}`);const u={$rowGroupValue:e,$rowDisplayGroupValue:i,$groupLevel:t,$isGroupRow:!0,$hasChildrenGroups:l,id:n.id,childrenAmount:o.groupsChildrenForFiltering[e].length,expanded:c,$agValues:{}};l?(o.aggregations.forEach((t=>{const r=o.groupsChildrenForFiltering[e].map((e=>e.$agValues[t.index]));u.$agValues[t.index]=o.getAggregationResult(t,r)})),u.amount=o.groupsChildrenForFiltering[e].reduce(((e,t)=>e+t.amount),0)):(o.aggregations.forEach((t=>{const r=o.groupsChildrenForFiltering[e].map((e=>e[t.index]));u.$agValues[t.index]=o.getAggregationResult(t,r)})),u.amount=u.childrenAmount,u.expanded&&(o.expandedGroupsWithDataChildrenForFiltering[e]=!0)),o.groupDetailsForFiltering[e]=u,0!==t&&o.groupsChildrenForFiltering[d].push(u)})),0===t)o.generateDisplayedGroupsForFiltering(e);else{const e=Object.keys(r);o.generateGroupsInfoForFiltering(e,t-1)}},clearGroups(){const e=this;delete e.groupsChildren,delete e.levelsWithGroups,delete e.expandedGroupsWithDataChildren,e.data.forEach((e=>{delete e.$rowGroupValue}))},set$rowGroupValue(e){return void 0===e&&(e=this.data),e.forEach((e=>{let t=[];this.rowGroups.forEach((o=>{t.push(e[o])})),e.$rowGroupValue=t.join("/")})),e},setExpandedGroups(){const e=this;switch(e.expandedGroups={},typeof e.rowGroupExpanded){case"function":case"boolean":const t=Object.keys(Object.groupBy(e.data,(e=>e.$rowGroupValue))),o={};t.forEach((e=>{const t=e.split("/"),r=t.length;for(let e=0;e<r;e++)t.pop(),o[t.join("/")]=!0}));const r=Object.keys(o);[].concat(t).concat(r).sort().forEach((t=>{const o=!0===e.rowGroupExpanded||e.rowGroupExpanded(t);e.expandedGroups[t]=o}));break;default:e.rowGroupExpanded?.forEach((t=>{e.expandedGroups[t]=!0}))}delete e.rowGroupExpanded},generateDisplayedGroupsForFiltering(e){const t=this;t.displayedGroupsForFiltering={},e.forEach((e=>{t.displayedGroupsForFiltering[e]=!0}));for(let e in t.expandedGroups){const o=t.groupsChildrenForFiltering[e];o?.forEach((({$rowGroupValue:e})=>{e&&(t.displayedGroupsForFiltering[e]=!0)}))}},sortGroups(){const e=this;e.levelsWithGroups.forEach((({0:t})=>{for(const o in t){const r=t[o].toSorted(((t,o)=>{const r=e.groupDetails[t],l=e.groupDetails[o];switch(e.defaultRowGroupSort){case"asc-amount":return r.amount-l.amount;case"desc-amount":return l.amount-r.amount}}));t[o]=r}}))},sortGroupsForFiltering(){const e=this,t=[];e.levelsWithGroups.forEach((({0:o},r)=>{const l={};for(const t in o){const n=o[t].filter((t=>e.displayedGroupsForFiltering[t]));(e.displayedGroupsForFiltering[t]||0===r)&&(l[t]=n)}t[r]=[l]})),e.levelsWithGroupsForFiltering=t},getSortedDisplayedGroups(){const e=this;let t=[];const o=(r,l=0)=>{r.forEach((r=>{if(t.push(r),e.expandedGroups[r]&&l!==e.levelsWithGroups.length-1){const t=l+1,n=e.levelsWithGroups[t][0][r];o(n,t)}}))};switch(e.defaultRowGroupSort){case"desc-string":t=Array.from(Object.keys(e.displayedGroups)).sort();break;case"desc-amount":const r=e.levelsWithGroups[0][0].root;o(r);break;default:console.error(`Not supported defaultRowGroupSort value ${e.defaultRowGroupSort}`)}return t},getSortedDisplayedGroupsForFiltering(){const e=this;let t=[];const o=(r,l=0)=>{r.forEach((r=>{if(t.push(r),e.expandedGroups[r]&&l!==e.levelsWithGroupsForFiltering.length-1){const t=l+1,n=e.levelsWithGroupsForFiltering[t][0][r];o(n,t)}}))};switch(e.defaultRowGroupSort){case"desc-string":t=Array.from(Object.keys(e.displayedGroupsForFiltering)).sort();break;case"desc-amount":const r=e.levelsWithGroupsForFiltering[0][0].root;o(r);break;default:console.error(`Not supported defaultRowGroupSort value ${e.defaultRowGroupSort}`)}return t},getAggregationResult(e,t){let o="";if("function"==typeof e.fn)o=e.fn(t);else switch(e.fn){case"sum":o=t.reduce(((e,t)=>e+t),0);break;case"avg":const e=t.reduce(((e,t)=>e+t),0);o=parseFloat((e/t.length).toFixed(2));break;case"min":o=t.sort()[0];break;case"max":o=t.sort()[t.length-1]}return o},expand(e){const t=this,o=t.groupDetails[e],r=t.idRowIndexesMap.get(o.id);o.expanded=!0,t.expandedGroups[e]=!0,o.$hasChildrenGroups||(t.expandedGroupsWithDataChildren[e]=!0);const l=t.getGroupExpandedChildren(e);t.displayedData.splice(r+1,0,...l),t.updateIndexes()},expandForFiltering(e){const t=this,o=t.groupDetailsForFiltering[e],r=t.idRowIndexesMap.get(o.id);o.expanded=!0,t.expandedGroups[e]=!0,o.$hasChildrenGroups||(t.expandedGroupsWithDataChildren[e]=!0,t.expandedGroupsWithDataChildrenForFiltering[e]=!0);const l=t.getGroupExpandedChildrenForFiltering(e);t.displayedData.splice(r+1,0,...l),t.updateIndexes()},expandAll(){const e=this;e.prevAction="";for(const t in e.groupDetails){const o=e.groupDetails[t];e.expandedGroups[t]=!0,o.expanded=!0,o.$hasChildrenGroups||(e.expandedGroupsWithDataChildren[t]=!0)}e.generateDisplayedGroupedData(),e.setIndexAndItemsMaps()},toggleExpand(e){const t=this;t.groupDetails[e].expanded?t.collapse(e):t.expand(e)},collapse(e){const t=this,o=t.getGroupExpandedChildren(e),r=t.groupDetails[e],l=t.idRowIndexesMap.get(r.id);r.expanded=!1,delete t.expandedGroups[e],r.$hasChildrenGroups||delete t.expandedGroupsWithDataChildren[e],t.displayedData.splice(l+1,o.length),t.updateIndexes()},collapseForFiltering(e){const t=this,o=t.groupDetailsForFiltering[e],r=t.getGroupExpandedChildrenForFiltering(e),l=t.idRowIndexesMap.get(o.id);o.expanded=!1,delete t.expandedGroups[e],o.$hasChildrenGroups||(delete t.expandedGroupsWithDataChildren[e],delete t.expandedGroupsWithDataChildrenForFiltering[e]),t.displayedData.splice(l+1,r.length),t.updateIndexes()},collapseAll(){const e=this;e.prevAction="";for(const t in e.groupDetails)e.expandedGroups[t]=!1,e.groupDetails[t].expanded=!1;e.generateDisplayedGroupedData(),e.setIndexAndItemsMaps()},getGroupExpandedChildren(e,t=[]){const o=this,r=o.groupDetails[e];let l=o.groupsChildren[e].slice();return!r.$hasChildrenGroups&&o.sorters.length?l=o.sortPieceOfData(l):l.sort(((e,t)=>{switch(o.defaultRowGroupSort){case"asc-amount":return e.amount-t.amount;case"desc-amount":return t.amount-e.amount}})),l.forEach((e=>{if(t.push(e),e.$isGroupRow&&e.expanded){const r=e.$rowGroupValue;o.getGroupExpandedChildren(r,t)}})),t},getGroupExpandedChildrenForFiltering(e,t=[]){const o=this,r=o.groupDetailsForFiltering[e];let l=o.groupsChildrenForFiltering[e].slice();return!r.$hasChildrenGroups&&o.sorters.length&&(l=o.sortPieceOfData(l)),l.forEach((e=>{if(t.push(e),e.$isGroupRow&&e.expanded){const r=e.$rowGroupValue;o.getGroupExpandedChildrenForFiltering(r,t)}})),t},reConfigRowGroups(e){const t=this,{sorters:o,filters:r}=t;t.setRowGroups(e),t.prevAction="",t.$dontDropExpandedGroups||(t.expandedGroups={}),delete t.groupsChildren,0===e.length?(t.clearGroups(),o.length||r.length?(r.length&&t.reFilter(!1),o.length&&t.reSort()):delete t.displayedData):r.length?(t.set$rowGroupValue(),t.generateGroupsInfo(),t.sortGroups(),t.rowGroupDataForFiltering(),t.sortGroupsForFiltering(),t.generateDisplayedGroupedDataForFiltering(),t.updateIndexes()):(t.set$rowGroupValue(),t.generateGroupsInfo(),t.sortGroups(),t.generateDisplayedGroupedData()),r.length&&e.length||t.setIndexAndItemsMaps()},setRowGroups(e){this.rowGroups=e},getGroupDataForFiltering(){const e=this,t=e.displayedData.slice();for(const o in e.expandedGroupsWithDataChildrenForFiltering){if(e.isParentCollapsed(o))continue;const r=e.groupsChildrenForFiltering[o].slice(),l=e.groupDetailsForFiltering[o],n=e.idRowIndexesMap.get(l.id);t.splice(n+1,r.length,...r)}return t},addGroup(e){const t=this,o=e.split("/");t.levelsWithGroups=t.levelsWithGroups||[[{root:[]}]],t.groupsChildren=t.groupsChildren||{},t.expandedGroupsWithDataChildren=t.expandedGroupsWithDataChildren||{},t.expandedGroups=t.expandedGroups||{},t.expandedGroupsWithDataChildren[e]=!0;const r=[];for(let l=0;l<o.length;l++){const n=o.slice(0,o.length-l).join("/"),s=n.split("/").length-1;if(t.groupDetails[n])break;const i=o.slice(0,o.length-l-1).join("/");0===s?t.levelsWithGroups[0][0].root.includes(n)||t.levelsWithGroups[0][0].root.push(n):(void 0===t.levelsWithGroups&&(t.levelsWithGroups=[[{root:[]}]]),void 0===t.levelsWithGroups[s]&&(t.levelsWithGroups[s]=[{}]),t.levelsWithGroups[s][0][i]||(t.levelsWithGroups[s][0][i]=[]),t.levelsWithGroups[s][0][i].push(n)),t.expandedGroups[n]=!0,t.groupsChildren[n]=[],t.groupDetails[n]={$rowGroupValue:n,$rowDisplayGroupValue:o[o.length-l-1],$groupLevel:s,$isGroupRow:!0,$hasChildrenGroups:e!==n,id:t.generateId(),childrenAmount:0,amount:0,expanded:!0,$agValues:{}},r.push(n)}r.forEach((e=>{const o=e.split("/");if(1===o.length)return;const r=o.slice(0,o.length-1).join("/");t.groupsChildren[r]=t.groupsChildren[r]||[],t.groupsChildren[r].push(t.groupDetails[e]),t.groupDetails[r].$hasChildrenGroups&&t.groupsChildren[r].sort(((e,o)=>{switch(t.defaultRowGroupSort){case"asc-amount":return e.amount-o.amount;case"desc-amount":return o.amount-e.amount}}))}))},agGroupUpdateData(e,t,o="-"){const r=this,l=r.groupDetails[e];if(!l)return;const n=l.$agValues||{},s=r.groupsChildren[e];r.aggregations?.forEach((l=>{const i=l.index;t.forEach((t=>{if(!1!==t.$rowGroupValue.includes(e))if("sum"===l.fn&&"update"!==o)switch(void 0===n[i]&&(n[i]=0),o){case"-":n[i]-=t[i];break;case"+":n[i]+=t[i]}else{const e=s.map((e=>{let t=e.$agValues?e.$agValues[i]:e[i];return t=Number(t),isNaN(t)&&(t=0),t}));n[i]=r.getAggregationResult(l,e)}}))}))},isItemInCollapsedGroup(e){const t=e.$rowGroupValue.split("/");e.$isGroupRow&&t.pop();for(let e=0;e<t.length;e++){const e=t.join("/");if(!this.expandedGroups[e])return!0;t.pop()}return!1}};Object.assign(Fancy.Store.prototype,e)})(),(()=>{const e={selectRowItem(e,t=!0){const o=this,r=e.$rowGroupValue;if(e.$selected=t,o.updateSelectedItemsMap(t,e),r){o.updateSelectedRowGroupsChildren(r,t,e),o.updateSelectedStatus(r);const l=r.split("/"),n=l.length;for(let e=0;e<n-1;e++){const e=l.join("/"),r=o.groupDetails[e],n=o.idItemMap.get(r.id);l.pop();const s=l.join("/");!t&&n.selectedStatus||o.updateSelectedRowGroupsChildren(s,t,n),o.updateSelectedStatus(s)}}},updateGroupsChildrenSelection(e,t){const o=this;o.groupsChildren[e].forEach((r=>{r.$selected=t,r.$isGroupRow||o.updateSelectedItemsMap(t,r),o.updateSelectedRowGroupsChildren(e,t,r);const l=r.$rowGroupValue;r.$isGroupRow&&(r.selectedStatus=!!t&&"full",o.updateGroupsChildrenSelection(l,t))}))},selectGroupRowItems(e,t=!0){const o=this,r=e.$rowGroupValue;e.$selected=t,e.selectedStatus=!!t&&"full",e.$isGroupRow||o.updateSelectedItemsMap(t,e),o.updateGroupsChildrenSelection(r,t),o.updateSelectedStatus(r);const l=r.split("/"),n=l.length;for(let e=0;e<n-1;e++){const e=l.join("/"),r=o.groupDetails[e],n=o.idItemMap.get(r.id);l.pop();const s=l.join("/");o.updateSelectedRowGroupsChildren(s,t,n),o.updateSelectedStatus(s)}},updateSelectedItemsMap(e,t){const o=this;t.$isGroupRow&&console.warn("It is wrong to use selectedItemsMap for group row. Only for items that do not have children."),e?o.selectedItemsMap.set(t.id,t):o.selectedItemsMap.delete(t.id)},updateSelectedRowGroupsChildren(e,t,o){const r=this.selectedRowGroupsChildren;t?(void 0===r[e]&&(r[e]=new Set),r[e].add(o.id)):r[e]&&(r[e].delete(o.id),0===r[e].size&&delete r[e])},updateSelectedStatus(e){const t=this,o=t.groupDetails[e],r=t.idItemMap.get(o.id);let l;if(t.selectedRowGroupsChildren[e])if(t.groupsChildren[e].length===t.selectedRowGroupsChildren[e].size){let o=!1;if(r.$hasChildrenGroups){const r=t.groupsChildren[e];for(let e=0;e<r.length;e++)if("partly"===r[e].selectedStatus){o=!0;break}}o?(l="partly",delete r.$selected):(l="full",r.$selected=!0)}else l="partly",delete r.$selected;else l=!1,r.$selected=!1,t.selectedItemsMap.delete(o.id);t.groupDetails[e].selectedStatus=l},selectAll(e=!0){const t=this;if(e){for(const e in t.groupsChildren){const o=t.groupsChildren[e],r=t.groupDetails[e];r&&(r.selectedStatus="full",r.$selected=!0,o.forEach((o=>{t.updateSelectedRowGroupsChildren(e,!0,o)})))}t.data.forEach((e=>{e.$selected=!0,t.selectedItemsMap.set(e.id,e)}))}else{for(const e in t.groupsChildren){const o=t.groupsChildren[e],r=t.groupDetails[e];r&&(r.selectedStatus=!1,delete r.$selected,o.forEach((o=>{t.updateSelectedRowGroupsChildren(e,!1,o)})))}t.data.forEach((e=>{delete e.$selected,t.selectedItemsMap.delete(e.id)}))}}};Object.assign(Fancy.Store.prototype,e)})(),(()=>{const e=Fancy.typeOf,t={setById(t,o,r){const l=this.idItemMap.get(t);if(!l)return!1;if("object"===e(o))for(let e in o)l[e]=o[e];else l[o]=r;return l},removeItemById(e){const t=this,o=t.idItemMap.get(e),r=o.originalDataRowIndex;return t.idItemMap.delete(e),t.idRowIndexesMap.delete(e),t.selectedItemsMap.delete(e),t.data[r]=void 0,o},add(t,o){const r=this;if("object"===e(t)&&(t=[t]),t.forEach((e=>{e.id||(e.id=r.generateId())})),r.rowGroups.length)return(t=r.set$rowGroupValue(t)).forEach((e=>{const t=e.$rowGroupValue;r.groupDetails[t]||r.addGroup(t),r.groupsChildren[t].push(e);const o=t.split("/");for(let e=0;e<o.length;e++){const t=o.slice(0,o.length-e).join("/"),l=r.groupDetails[t];l.amount++,l.childrenAmount++}r.data.push(e)})),r.generateDisplayedGroupedData(),void r.setIndexAndItemsMaps();void 0===o?(r.data.push(...t),r.displayedData&&r.displayedData.push(...t)):0===o?(r.data.unshift(...t),r.displayedData&&r.displayedData.unshift(...t)):"number"===e(o)?(r.data.splice(o,0,...t),r.displayedData&&r.displayedData.splice(o,0,...t)):"object"===e(o)&&(r.data.splice(o.originalRowIndex,0,...t),r.displayedData&&r.displayedData.splice(o.rowIndex,0,...t)),r.updateIndexes()},clearGroup(e){const t=this,o=e.split("/"),r=o.length-1;if(0===r)t.levelsWithGroups[0][0].root=t.levelsWithGroups[0][0].root.filter((t=>t!==e));else{o.pop();const l=o.join("/");t.levelsWithGroups[r][0][l]=t.levelsWithGroups[r][0][l].filter((t=>t!==e));const n=t.groupDetails[e];n?.$hasChildrenGroups&&t.levelsWithGroups[r+1]&&delete t.levelsWithGroups[r+1][0][e]}}};Object.assign(Fancy.Store.prototype,t)})(),(()=>{const{BODY_VERTICAL_SCROLL:e,BODY_VERTICAL_SCROLL_CONTAINER:t,BODY_VERTICAL_SCROLL_SIZE:o,BODY_HORIZONTAL_SCROLL:r,BODY_HORIZONTAL_SCROLL_CONTAINER:l,BODY_HORIZONTAL_SCROLL_SIZE:n,SCROLLBAR_INVISIBLE:s}=Fancy.cls,i=Fancy.div;Fancy.Scroller=class{startRow=0;endRow=0;scrollTop=0;scrollLeft=0;maxScrollTop=0;topBufferRows=10;bufferRows=30;extraBufferRows=20;columnViewStart=0;columnViewEnd=0;columnsViewRange=[];scrollBarWidth=17;isDomInvisibleScrollbar=!1;constructor(e){const t=this;t.grid=e.grid,t.calcScrollBarWidth(),t.calcViewRange(),t.initResizeObserver()}deltaChange(e){const t=this;if(!t.isVerticalVisible())return t.scrollTop=0,t.verticalScrollContainerEl.scrollTop=0,!1;let o=!1,r=t.scrollTop-e;return r<0&&(r=0),r>t.maxScrollTop&&(r=t.maxScrollTop),t.scrollTop!==r&&(o=!0),t.scrollTop=r,t.verticalScrollContainerEl.scrollTop=r,o}horizontalDeltaChange(e){const t=this;if(!t.isHorizontalVisible())return t.scrollLeft=0,t.horizontalScrollContainerEl.scrollLeft=0,!1;let o=!1,r=t.scrollLeft-e;return r<0&&(r=0),t.horizontalScrollContainerEl.scrollLeft!==r&&(o=!0),t.horizontalScrollContainerEl.scrollLeft=r,t.scrollLeft=t.horizontalScrollContainerEl.scrollLeft,o}calcVisibleRows(){const e=this;let t=!1;const o=Math.ceil(e.grid.height/e.grid.rowHeight)+e.extraBufferRows;return e.bufferRows<o&&(t=!0),e.bufferRows=o,t}calcMaxScrollTop(){const e=this;e.maxScrollTop=e.grid.store.getDisplayedDataTotal()*e.grid.rowHeight-e.grid.bodyEl.getBoundingClientRect().height,e.maxScrollTop<0&&(e.maxScrollTop=0)}updateScrollTop(){const e=this;e.scrollTop>e.maxScrollTop&&(e.scrollTop=e.maxScrollTop,e.verticalScrollContainerEl.scrollTop=e.maxScrollTop)}getStartRow(){return this.calcStartRow(),this.startRow}calcStartRow(){const e=this;let t=Math.round(e.scrollTop/e.grid.rowHeight)-e.topBufferRows;const o=e.getEndRow();o-t<e.bufferRows&&(t=o-e.bufferRows),t<0&&(t=0),e.startRow=t}getEndRow(){const e=this,t=e.grid.store,{rowGroups:o}=t,r=t.getDisplayedDataTotal();let l=Math.round(e.scrollTop/e.grid.rowHeight)-e.topBufferRows+e.bufferRows;return!o.length&&l>e.grid.store.getDataTotal()&&(l=e.grid.store.getDataTotal()),l>r&&(l=r),e.endRow=l,l}render(){const e=this;e.renderVerticalScroll(),e.renderHorizontalScroll(),e.ons()}renderVerticalScroll(){const r=this,l=i(e);r.isDomInvisibleScrollbar&&l.classList.add(s);const n=i(t,{width:r.scrollBarWidth+"px"}),a=i(o,{width:r.scrollBarWidth+"px"});n.appendChild(a),l.appendChild(n),r.grid.bodyEl.appendChild(l),r.verticalScrollEl=l,r.verticalScrollContainerEl=n,r.verticalScrollSizeEl=a,r.setVerticalSize()}renderHorizontalScroll(){const e=this,t=`${e.scrollBarWidth}px`,o=i(r,{height:t,minHeight:t,maxHeight:t,width:e.isDomInvisibleScrollbar||!e.isVerticalVisible()?"100%":`calc(100% - ${t})`});e.isDomInvisibleScrollbar&&o.classList.add(s);const a=i(l,{height:t,minHeight:t,maxHeight:t}),d=i(n,{height:t,minHeight:t,maxHeight:t});a.appendChild(d),o.appendChild(a),e.grid.gridEl.appendChild(o),e.horizontalScrollEl=o,e.horizontalScrollContainerEl=a,e.horizontalScrollSizeEl=d,e.setHorizontalSize()}updateHorizontalScrollSize(){const e=this,t=e.horizontalScrollEl;e.isDomInvisibleScrollbar?t.style.width="100%":e.isVerticalVisible()?t.style.width=`calc(100% - ${e.scrollBarWidth}px)`:t.style.width="100%"}ons(){const e=this;e.verticalScrollContainerEl.addEventListener("scroll",e.onVerticalScroll),e.horizontalScrollContainerEl.addEventListener("scroll",e.onHorizontalScroll)}onVerticalScroll=()=>{const e=this;e.grid.wheelScrolling||(e.scrollTop=e.verticalScrollContainerEl.scrollTop,e.grid.bodyInnerEl.scrollTop=e.scrollTop,cancelAnimationFrame(e.grid.animationRenderId),e.grid.animationRenderId=requestAnimationFrame((()=>{e.grid.renderVisibleRows()})),cancelAnimationFrame(e.grid.animationRemoveId),e.grid.animationRemoveId=requestAnimationFrame((()=>{e.grid.removeNotNeededRows()})))};onHorizontalScroll=()=>{const e=this,t=e.grid;e.scrollLeft=e.horizontalScrollContainerEl.scrollLeft,t.headerEl.scrollLeft=e.scrollLeft,t.bodyInnerEl.scrollLeft=e.scrollLeft,t.filterBar&&(t.filterBarEl.scrollLeft=e.scrollLeft),cancelAnimationFrame(t.horizontalScrollId),e.grid.horizontalScrollId=requestAnimationFrame((()=>{e.generateNewRange()}))};generateNewRange(e=!0){const t=this,o=t.grid,{columnStart:r,columnEnd:l,range:n}=t.getColumnsViewRange(),s=new Set(n),i=new Set(t.columnsViewRange),a=[],d=[];return e&&(n.forEach((e=>{o.columns[e].hidden||i.has(e)||a.push(e)})),i.forEach((e=>{s.has(e)||d.push(e)}))),t.columnsViewRange=n,t.columnViewStart=r,t.columnViewEnd=l,o.addColumnCells(a),o.removeColumnCells(d),{columnsViewRange:t.columnsViewRange,columnViewStart:t.columnViewStart,columnViewEnd:t.columnViewEnd,columnsToAdd:a,columnsToRemove:d}}setVerticalSize(){const e=this,t=e.grid,o=t.store,{filters:r,rowGroups:l}=o;let n;n=r.length||l.length?o.getDisplayedDataTotal()*t.rowHeight:o.getDataTotal()*t.rowHeight,e.verticalScrollSizeEl.style.height=n+"px",e.isVerticalVisible()?e.verticalScrollEl.style.display="":e.verticalScrollEl.style.display="none"}isHorizontalVisible(){const e=this.grid.bodyEl.getBoundingClientRect().width;return this.grid.columns.reduce(((e,t)=>t.hidden?e:e+t.width),0)>e}isVerticalVisible(){const e=this.grid,t=e.store,{filters:o,rowGroups:r}=t,l=e.bodyEl.getBoundingClientRect().height,n=e.rowHeight;let s;return s=o.length||r.length?t.getDisplayedDataTotal()*n:t.getDataTotal()*n,l<s}setHorizontalSize(){const e=this,t=e.grid.getTotalColumnsWidth();e.horizontalScrollSizeEl.style.width=`${t}px`,e.isHorizontalVisible()?e.horizontalScrollEl.style.display="":e.horizontalScrollEl.style.display="none"}calcViewRange(){const e=this,{columnStart:t,columnEnd:o,range:r}=e.getColumnsViewRange();e.columnViewStart=t,e.columnViewEnd=o,e.columnsViewRange=r}getColumnsViewRange(){const e=this,t=e.grid.width;let o,r,l=[],n=0;for(let s=0;s<e.grid.columns.length;s++){const i=e.grid.columns[s];if(!i.hidden){if(void 0===o&&n<=e.scrollLeft&&n+i.width>e.scrollLeft&&(o=s),void 0!==o&&l.push(s),void 0===r&&n<=e.scrollLeft+t&&n+i.width>=e.scrollLeft+t){e.grid.columns[s+1]?(r=s+1,l.push(s+1)):r=s;break}n+=i.width}}return void 0===r&&(r=e.grid.columns.length-1),{columnStart:o,columnEnd:r,range:l}}calcScrollBarWidth(){this.scrollBarWidth=this.getScrollbarWidth()}getScrollbarWidth(){const e=document.body,t=i([],{width:"100px",height:"100px",opacity:"0",overflow:"scroll",msOverflowStyle:"scrollbar",position:"absolute"});e.appendChild(t);let o=t.offsetWidth-t.clientWidth;return t.parentNode&&t.parentNode.removeChild(t),0===o&&(this.isDomInvisibleScrollbar=0===o,o=16),o}initResizeObserver(){const e=this;e.resizeObserver=new ResizeObserver((t=>{Array.isArray(t)&&t.length&&e.grid.checkSize()&&e.updateSize()})),e.resizeObserver.observe(e.grid.containerEl)}updateSize(){const e=this,t=e.grid,o=e.calcVisibleRows();e.generateNewRange(),t.reCalcColumnsPositions(),t.updateWidth(),t.updateCellPositions(),o&&t.renderVisibleRows()}isColumnVisible(e){const t=this;if(!e)return!1;for(let o=0,r=t.columnsViewRange.length;o<r;o++){const r=t.columnsViewRange[o];if(t.grid.columns[r].id===e.id)return!0}return!1}}})(),Fancy.TouchScroller=class{constructor(e,t){const o=this;Object.assign(o,t),o.element=e,o.startY=0,o.startX=0,o.velocityX=0,o.velocityY=0,o.lastMoveTime=0,o.touchStartHandler=o.touchStart.bind(o),o.touchMoveHandler=o.touchMove.bind(o),o.touchEndHandler=o.touchEnd.bind(o),o.init()}init(){const e=this;e.element.addEventListener("touchstart",e.touchStartHandler),e.element.addEventListener("touchmove",e.touchMoveHandler),e.element.addEventListener("touchend",e.touchEndHandler)}touchStart(e){const t=this;delete t.direction,t.startY=e.touches[0].pageY,t.startX=e.touches[0].pageX,t.velocityX=0,t.velocityY=0,t.lastMoveTime=Date.now(),t.intervalId&&(clearInterval(t.intervalId),delete t.intervalId)}touchMove(e){const t=this,o=e.touches[0].pageY,r=e.touches[0].pageX,l=Date.now(),n=o-t.startY,s=r-t.startX,i=l-t.lastMoveTime;t.velocityX=s/i,t.velocityY=n/i,t.startY=o,t.startX=r,t.lastMoveTime=l,t.direction||(t.direction=Math.abs(n)>Math.abs(s)?"vertical":"horizontal"),"vertical"===t.direction?Object.assign(e,{deltaX:0,deltaY:n}):Object.assign(e,{deltaX:s,deltaY:0}),t.onTouchScroll(e)}smoothScroll(){const e=this,t=()=>{e.velocityX*=.98,e.velocityY*=.98,"vertical"===e.direction?e.onTouchScroll({deltaX:0,deltaY:10*e.velocityY}):e.onTouchScroll({deltaX:10*e.velocityX,deltaY:0}),Math.abs(e.velocityX)<=.2&&Math.abs(e.velocityY)<=.2||requestAnimationFrame((()=>{requestAnimationFrame(t)}))};requestAnimationFrame(t)}touchEnd(){this.smoothScroll()}destroy(){const e=this;e.element.removeEventListener("touchstart",e.touchStartHandler),e.element.removeEventListener("touchmove",e.touchMoveHandler),e.element.removeEventListener("touchend",e.touchEndHandler),e.intervalId&&clearInterval(e.intervalId)}},(()=>{const{GRID:e,GRID_CELLS_RIGHT_BORDER:t,ROW_ANIMATION:o,HEADER:r,HEADER_INNER:l,HEADER_INNER_CONTAINER:n,BODY:s,BODY_INNER:i,BODY_INNER_CONTAINER:a,EDITORS_CONTAINER:d,TOUCH:c}=Fancy.cls,u=Fancy.div;class p{theme="default";defaultColumnWidth=120;headerRowHeight=32;rowHeight=28;rowAnimation=!0;minColumnWidth=35;rowGroupType="row";defaultRowGroupSort="desc-amount";rowGroupBarSeparator=!1;actualRowsIdSet;renderedRowsIdMap;activeCell=!0;selectingCells=!0;editorEnterAction="stay";startEditByTyping=!0;flashChanges=!0;flashChangesColors=["#e0e5e9","beige"];filterBar=!1;cellsRightBorder=!1;columnLines=!1;rowGroupBar=!1;$defaultRowGroupColumn={title:"Group",width:120,sortable:!1,type:"string",rowGroupIndent:!0,editable:!1,render(e){const{value:t}=e;return t||""}};constructor(e,t){const o=this;t&&(t.renderTo=e,e=t),o.initContainer(e.renderTo),o.initId(e.id),o.actualRowsIdSet=new Set,o.renderedRowsIdMap=new Map,e=o.prepareConfig(e),Object.assign(o,e),o.checkInitialSize(),o.checkSize(),o.initScroller(),o.render();const r=o.scroller;r.calcMaxScrollTop(),r.calcVisibleRows(),o.renderVisibleRows(),o.renderVisibleHeaderCells(),o.filterBar&&o.renderVisibleFilterBarCells(),o.activeCell&&o.initKeyNavigation(),o.ons()}initContainer(e){const t=this;e.tagName?t.containerEl=e:"string"==typeof e&&(t.containerEl=document.getElementById(e),t.containerEl||(t.containerEl=document.querySelector(e))),t.containerEl||console.error("Could not find renderTo element")}initId(e){const t=this;e&&(t.id=e),t.id||(t.id=`fg-grid-${Fancy.gridIdSeed}`,Fancy.gridIdSeed++),Fancy.gridsMap.set(t.id,t)}render(){const r=this,l=[e,"fg-theme-"+r.theme];r.rowAnimation&&l.push(o),(r.cellsRightBorder||r.columnLines)&&l.push(t),Fancy.isTouchDevice&&l.push(c);const n=u(l);n.setAttribute("id",r.id),r.containerEl.appendChild(n),r.gridEl=n,r.rowGroupBar&&r.renderRowGroupBar(),r.renderHeader(),r.filterBar&&r.renderFilterBar(),r.renderBody(),r.scroller.render()}updateWidth(){const e=this,t=e.getTotalColumnsWidth(),o=t+e.scroller.scrollBarWidth,r=t;e.headerInnerEl.style.width=o+"px",e.headerInnerContainerEl.style.width=t+"px",e.bodyInnerContainerEl.style.width=r+"px",e.filterBar&&(e.filterBarInnerEl.style.width=o+"px",e.filterBarInnerContainerEl.style.width=t+"px"),e.scroller.setHorizontalSize()}renderHeader(){const e=this,t=u(r,{height:this.headerRowHeight+1+"px"}),o=u(l,{width:e.getTotalColumnsWidth()+e.scroller.scrollBarWidth+"px"}),s=u(n,{height:e.headerRowHeight+"px",width:e.getTotalColumnsWidth()+"px"});o.appendChild(s),t.appendChild(o),e.gridEl.appendChild(t),e.headerInnerContainerEl=s,e.headerInnerEl=o,e.headerEl=t}renderBody(){const e=this,t=u(s),o=u(i),r=u(a,{width:e.getTotalColumnsWidth()+"px",height:e.store.rowGroups.length?e.store.getDisplayedDataTotal()*e.rowHeight+"px":e.store.getDataTotal()*e.rowHeight+"px"}),l=u(d);r.appendChild(l),o.appendChild(r),t.appendChild(o),e.gridEl.appendChild(t),e.editorsContainerEl=l,e.bodyInnerContainerEl=r,e.bodyInnerEl=o,e.bodyEl=t}updateVisibleHeight(){const e=this,t=e.store,{filters:o,rowGroups:r}=t;o.length||r.length?e.bodyInnerContainerEl.style.height=t.getDisplayedDataTotal()*e.rowHeight+"px":e.bodyInnerContainerEl.style.height=t.getDataTotal()*e.rowHeight+"px"}animatedRemoveDomRowById(e){const t=this,o=t.renderedRowsIdMap.get(e);o?(o.style.opacity=0,setTimeout((()=>{o.remove()}),200)):console.warn(`Row El with id = ${e} was not found`),t.actualRowsIdSet.delete(e),t.renderedRowsIdMap.delete(e)}removeDomRowById(e){const t=this,o=t.renderedRowsIdMap.get(e);o&&o.remove(),t.actualRowsIdSet.delete(e),t.renderedRowsIdMap.delete(e)}prepareConfig(e){const t=this;let o=[],r=[];if(e.columns){e.columns=Fancy.deepClone(e.columns);let l=0,n=!1;if(t.generateColumnIds(e.columns),"column"===e.rowGroupType&&(e.rowGroupColumn=e.rowGroupColumn||{}),e.columns.forEach((e=>{e.rowGroup&&(e.hidden=!0,o.push(e.index),void 0!==e.rowGroupOrder&&(n=n||[],n[e.rowGroupOrder]=e.index))})),n){const e=structuredClone(o).filter((e=>!n.includes(e)));o.forEach(((t,o)=>{void 0===n[o]&&(t=e.shift(),n[o]=t)})),n=n.concat(e),o=n}if(e.rowGroupColumn){let r=Object.assign({$isRowGroupColumn:!0},t.$defaultRowGroupColumn);r.id=r.id||t.getAutoColumnIdSeed(),Object.assign(r,e.rowGroupColumn),t.$rowGroupColumn=r,o.length&&t.$rowGroupColumn&&("order"===e.columns[0].type?e.columns.splice(1,0,r):e.columns.unshift(r))}e.columns.forEach((n=>{"order"===n.type&&(o.length||e.rowGroupBar)&&"column"!==e.rowGroupType&&(console.error('Order column is not supported for row grouping with rowGroupType equals to "row"'),console.error('For order column use rowGroupType equals to "column"')),t.prepareColumn(n,e.defaults),n.checkboxSelection&&(e.checkboxSelection=!0),n.agFn&&r.push({index:n.index,fn:n.agFn}),n.left=l,n.hidden||(l+=n.width)}))}const l={data:structuredClone(e.data),defaultRowGroupSort:e.defaultRowGroupSort||t.defaultRowGroupSort};return o.length&&(Object.assign(l,{rowGroups:o,aggregations:r,rowGroupExpanded:e.rowGroupExpanded||[]}),delete e.rowGroupExpanded),t.initStore(l),delete e.data,e}initStore(e){this.store=new Fancy.Store(e)}ons(){const e=this;e.debouceClearWheelScrollingFn=Fancy.debounce(e.clearWheelScrolling,50),e.bodyEl.addEventListener("wheel",e.onMouseWheel.bind(this)),e.touchScroller=new Fancy.TouchScroller(e.bodyEl,{onTouchScroll:e.onTouchScroll.bind(this)}),e.headerInnerContainerEl.addEventListener("click",e.onHeaderCellClick.bind(this)),e.headerInnerContainerEl.addEventListener("mousedown",e.onHeaderMouseDown.bind(this))}getTotalColumnsWidth(){return this.columns.reduce(((e,t)=>e+(t.hidden?0:t.width)),0)}reCalcColumnsPositions(){this.columns.reduce(((e,t)=>(t.left=e,e+(t.hidden?0:t.width))),0)}checkInitialSize(){const e=this;e.width&&(e.initialWidth=e.width,delete e.width,e.containerEl.style.width=e.initialWidth+"px"),e.height&&(e.initialHeight=e.height,delete e.height,e.containerEl.style.height=e.initialHeight+"px")}checkSize(){const e=this,t=e.containerEl.getBoundingClientRect();let o=!1;return e.initialWidth&&e.width===t.width||(e.width=t.width,o=!0),(e.initialHeight||e.height!==t.height)&&(e.height=t.height,o=!0),o}setData(e){const t=this.store;t.$dontDropExpandedGroups=!0,t.setData(structuredClone(e)),this.reRender(),delete t.$dontDropExpandedGroups}reRender(){const e=this,t=e.store,o=e.scroller;e.store.rowGroups.length?e.reConfigRowGroups():(e.terminateVisibleRows(),o.calcMaxScrollTop(),o.updateScrollTop(),o.calcViewRange(),o.setVerticalSize(),o.updateHorizontalScrollSize(),e.updateVisibleHeight(),o.calcVisibleRows(),e.renderVisibleRows(),t.memorizePrevRowIndexesMap())}destroy(){this.touchScroller.destroy(),this.gridEl.remove()}onBodyCellClick(){this.hideActiveEditor()}remove(e){const t=this,o=t.store;if(0===(e=t.$processRowsToRemove(e)).length)return;let r=[],l=[],n=new Map;for(let s=0;s<e.length;s++){const i=e[s];t.animatedRemoveDomRowById(i.id);let a=o.removeItemById(i.id);if(r.push(a),a.$rowGroupValue){let e=n.get(a.$rowGroupValue)||[];e.push(a.id),n.set(a.$rowGroupValue,e),o.selectRowItem(a,!1)}!0!==a.$isGroupRow&&l.push(a)}n.forEach(((e,n)=>{const s=n.split("/");for(let n=0;n<s.length;n++){const i=s.slice(0,s.length-n).join("/"),a=o.groupDetails[i];if(a.amount-=e.length,!1===a.$hasChildrenGroups&&(a.childrenAmount-=e.length),0===a.amount){a.childrenAmount=0,t.animatedRemoveDomRowById(a.id),delete o.groupDetails[i],delete o.expandedGroupsWithDataChildren[i],delete o.groupsChildren[i];let e=t.store.removeItemById(a.id);r.push(e);const l=s.slice(0,s.length-n-1).join("/"),d=o.groupDetails[l];o.groupsChildren[l]=o.groupsChildren[l].filter((e=>e.id!==a.id)),d&&d.childrenAmount--,o.clearGroup(i)}else o.groupsChildren[i]=o.groupsChildren[i].filter((t=>!1===e.includes(t.id)));if(o.groupDetailsForFiltering){const r=o.groupDetailsForFiltering[i];if(r.amount-=e.length,r.amount<=0){r.childrenAmount=0,delete t.store.groupDetailsForFiltering[i],delete t.store.expandedGroupsWithDataChildrenForFiltering[i],delete t.store.groupsChildrenForFiltering[i];const e=s.slice(0,s.length-n-1).join("/");o.groupsChildrenForFiltering[e]=o.groupsChildrenForFiltering[e].filter((e=>e.id!==a.id))}else o.groupsChildrenForFiltering[i]=o.groupsChildrenForFiltering[i].filter((t=>!1===e.includes(t.id)))}o.agGroupUpdateData(i,l)}})),l.sort(((e,t)=>e.originalDataRowIndex-t.originalDataRowIndex)).forEach(((e,o)=>{t.store.data.splice(e.originalDataRowIndex-o,1)})),delete t.store.$isOriginalDataIndexesSet,t.store.displayedData?.length&&r.filter((e=>!e.$rowGroupValue||!o.isItemInCollapsedGroup(e))).sort(((e,t)=>e.rowIndex-t.rowIndex)).forEach(((e,o)=>{t.store.displayedData.splice(e.rowIndex-o,1)})),n.size&&(t.updateRowGroupAmount(),t.updateRowGroupAggregations(),t.updateRowGroupRowsAndCheckBoxes()),o.updateIndexes(),t.scroller.calcVisibleRows(),t.renderVisibleRows(),t.updateAfterAddRemove(),t.updateHeaderCheckboxesSelection(),t.updateOrderColumn()}add(e,t){const o=this,r=o.store;if(r.add(e,t),r.rowGroups.length){let t={};e.forEach((e=>{t[e.$rowGroupValue]=t[e.$rowGroupValue]||[],t[e.$rowGroupValue].push(e)}));for(let e in t){const o=e.split("/");for(let l=0;l<o.length;l++){const n=o.slice(0,o.length-l).join("/");r.agGroupUpdateData(n,t[e],"+")}}o.updateRowGroupAmount(),o.updateRowGroupAggregations(),o.updateRowGroupRowsAndCheckBoxes()}o.scroller.calcVisibleRows(),o.renderVisibleRows(),o.updateAfterAddRemove(),o.updateHeaderCheckboxesSelection(),o.updateOrderColumn()}setById(e,t,o){const r=this,l=r.store,n=r.renderedRowsIdMap.get(e),s=r.flashChangesColors,i=n?.getAttribute("row-index"),a=t=>{if(!t)return;const o=Number(t.getAttribute("col-index")),a=r.createCell(i,o);if(t.innerHTML===a.innerHTML)return;t.remove();const d=(t=a).style;r.flashChanges&&!t.style.backgroundColor&&(d.transition="background-color 2000ms",d.backgroundColor=s[l.selectedItemsMap.has(e)?1:0],setTimeout((()=>{d.backgroundColor=""})),setTimeout((()=>{d.transition="",d.backgroundColor=""}),2e3)),n.appendChild(t)};if("object"==typeof t)for(let o in t){l.setById(e,o,t[o]);let r=n?.querySelector(`div[col-id="${o}"]`);a(r)}else{l.setById(e,t,o);let r=n?.querySelector(`div[col-id="${t}"]`);a(r)}n&&r.rowCellsUpdateWithColumnRender(n,r.flashChanges)}getItemById(e){return this.store.idItemMap.get(e)}}window.Grid=p,Fancy.Grid=p})(),(()=>{const{ANIMATE_CELLS_POSITION:e,CELL:t,HEADER_CELL:o,FILTER_BAR_CELL:r,ROW:l}=Fancy.cls,n={showColumn(t,o){const r=this;o&&(r.animatingColumnsPosition=!0,r.gridEl.classList.add(e)),delete t.hidden,r.scroller.generateNewRange(),r.reCalcColumnsPositions(),r.updateWidth(),r.updateCellPositions(),o&&setTimeout((()=>{r.gridEl.classList.remove(e),delete r.animatingColumnsPosition}),300)},hideColumn(t,o){const r=this;if(!r.isPossibleToHideColumn())return console.warn("Hiding column was prevented because it requires at least 1 visible column"),!1;o&&!r.animatingColumnsPosition&&(r.animatingColumnsPosition=!0,r.gridEl.classList.add(e)),t.hidden=!0;const{columnsToRemove:l}=r.scroller.generateNewRange();return r.reCalcColumnsPositions(),r.updateWidth(),r.updateCellPositions(),o&&r.animatingColumnsPosition&&setTimeout((()=>{r.gridEl.classList.remove(e),delete r.animatingColumnsPosition}),300),r.activeCell&&r.clearActiveCell(),{columnIndex:l[0]}},isPossibleToHideColumn(){const e=this.columns.reduce(((e,t)=>e+(t.hidden?1:0)),0);return this.columns.length-e!=1},removeColumn(e){const t=this,{columnIndex:o}=t.hideColumn(e,!1);t.columns.splice(o,1),t.clearColumFromLinks(e),delete t.$rowGroupColumn.elSortOrder,delete t.$rowGroupColumn.filterCellEl,delete t.$rowGroupColumn.headerCellEl,delete t.$rowGroupColumn.left,t.scroller.generateNewRange(!1),t.reSetVisibleHeaderColumnsIndex(),t.reSetVisibleBodyColumnsIndex(),t.reCalcColumnsPositions()},clearColumFromLinks(e){delete e.elFilter,delete e.elMenu,delete e.elSortAsc,delete e.elSortDesc,delete e.elSortOrder,delete e.filterCellEl,delete e.filterField,delete e.headerCellEl},getColumn(e){return this.columns.find((t=>t.index===e))},getColumnById(e){return this.columnIdsMap.get(e)},getNextVisibleColumnIndex(e){const t=this;for(let o=e+1;o<t.columns.length;o++)if(!0!==t.columns[o].hidden)return o},getPrevVisibleColumnIndex(e){const t=this;for(let o=e-1;o>-1;o--)if(!0!==t.columns[o].hidden)return o},getAutoColumnIdSeed(){const e=this;return void 0===e.columnIdSeed?e.columnIdSeed=0:e.columnIdSeed++,e.columnIdSeed},generateColumnIds(e,t=!0){const o=this,r=new Map,l=new Map;return e.forEach((e=>{const t=(e.index||e.title||"").toLocaleLowerCase();if(e.id){let e=l.get(t);void 0===e&&(e=0),e++,l.set(t,e)}else{let r=l.get(t);void 0===r?(e.id=t||o.getAutoColumnIdSeed(),r=0):e.id=`${t}-${r}`,r++,l.set(t,r)}r.set(e.id,e)})),t&&(o.columnIdsMap=r,o.columnIdsSeedMap=l),{columnIdsMap:r,columnIdsSeedMap:l}},setColumns(t){const o=this;t=Fancy.deepClone(t),o.animatingColumnsPosition=!0,o.gridEl.classList.add(e),o.$setColumns(t),o.scroller.generateNewRange(!1),o.reCalcColumnsPositions(),o.updateWidth(),o.terminateNotExistedCells(),o.reSetVisibleHeaderColumnsIndex(),o.reSetVisibleBodyColumnsIndex(),o.renderMissedCells(),o.updateCellPositions(),setTimeout((()=>{o.gridEl.classList.remove(e),delete o.animatingColumnsPosition}),300)},renderMissedCells(){const e=this;let t=e.scroller.columnViewStart,o=e.scroller.columnViewEnd;const r=[];for(let l=t;l<=o;l++){const t=e.columns[l];t.hidden||t.headerCellEl||r.push(l)}e.addColumnCells(r)},terminateNotExistedCells(){const e=this;e.headerEl.querySelectorAll(`.${o}`).forEach((o=>{const l=o.getAttribute("col-id"),n=e.getColumnById(l),s=e.scroller.isColumnVisible(n);if(!n||!s){o.remove(),n&&n.filterCellEl&&n.filterCellEl.remove();const s=e.filterBarEl?.querySelector?.(`.${r}[col-id="${l}"]`);s?.remove(),e.bodyEl.querySelectorAll(`.${t}[col-id="${l}"]`).forEach((e=>{e.remove()}))}n&&!s&&e.clearColumFromLinks(n)}))},$setColumns(e){const t=this,o=new Map,r=new Set,{columnIdsMap:l,columnIdsSeedMap:n}=t.generateColumnIds(e,!1);t.columns.forEach((e=>{if(l.has(e.id)){const t=l.get(e.id);"number"==typeof t.width&&t.width!==e.width&&(e.width=t.width)}else r.add(e.id)}));const s=new Map;e.forEach(((e,r)=>{t.columnIdsMap.has(e.id)||(t.prepareColumn(e,t.defaults),o.set(e.id,e)),s.set(r,e.id)})),r.forEach((e=>{const o=t.getColumnById(e),r=(o.index||o.title||"").toLocaleLowerCase();t.columnIdsMap.delete(e);let l=t.columnIdsSeedMap.get(r);"number"==typeof l&&(l--,0===l?t.columnIdsSeedMap.delete(r):t.columnIdsSeedMap.set(r,l))})),o.forEach(((e,o)=>{t.columnIdsMap.set(o,e),t.columnIdsSeedMap.set(o,n.get(o))}));const i=[];s.forEach(((e,o)=>{const r=t.getColumnById(e);i[o]=r})),t.columns=i},prepareColumn(e,o={}){const r=this,n=r.store;switch(e.type){case"boolean":e.render=Fancy.render.boolean,e.onCheckBoxChange=(o,n)=>{const s=o.target.closest(`.${t}`).closest(`.${l}`).getAttribute("row-id");r.store.setById(s,e.index,n)};break;case"currency":Object.assign(e,{format:Fancy.format.currency,type:"number",$type:"currency"});break;case"order":Object.assign(e,{sortable:!1,render:Fancy.render.order,width:e.width||45,resizable:!1,menu:!1,draggable:!1}),r.columnOrder=e,(n?.rowGroups.length||r?.rowGroupBar)&&console.error("Order column is not supported for row grouping")}void 0===e.width&&(e.width=r.defaultColumnWidth),e.minWidth&&e.width<e.minWidth&&(e.width=e.minWidth),e.title||(e.title=Fancy.capitalizeFirstLetter(e.index||"")),Object.keys(o).forEach((t=>{void 0===e[t]&&(e[t]=o[t])}))}};Object.assign(Grid.prototype,n)})(),(()=>{const{ANIMATE_CELLS_POSITION:e,HIDDEN:t,HEADER_CELL:o,HEADER_CELL_LABEL:r,HEADER_CELL_MENU:l,HEADER_CELL_SELECTION:n,HEADER_CELL_SORTABLE:s,HEADER_CELL_NOT_RESIZABLE:i,HEADER_CELL_TEXT:a,HEADER_FILTER_EL:d,HEADER_CELL_RESIZE:c,BODY:u,COLUMN_RESIZING:p,COLUMN_DRAGGING:h,COLUMNS_MENU:g,COLUMNS_MENU_ITEM:m,COLUMNS_MENU_ITEM_TEXT:C,FILTER_INDICATOR_CONTAINER:w,SORT_ASC:E,SORT_DESC:f,SORT_ORDER:R,SORT_INDICATOR_CONTAINER:I,INPUT_CHECKBOX:v,ROW_GROUP_BAR_ITEM_ACTIVE:y}=Fancy.cls,{div:L,span:G,input:x}=Fancy,S={deltaStartColumnDrag:10,onHeaderMouseDown(e){e.preventDefault()},onHeaderCellClick(e){const t=this,n=e.target.closest(`.${r}`),s=e.target.closest(`.${l}`),i=e.shiftKey;if(!t.columnDragging){if(n){const e=n.closest(`.${o}`).getAttribute("col-index"),r=t.columns[e];if(!r.sortable||!r.type)return;switch(r.sort){case"ASC":i?t.multiSort(r,"DESC"):t.sort(r,"DESC");break;case"DESC":t.clearSort(r,i);break;case void 0:i?t.multiSort(r,"ASC"):t.sort(r,"ASC")}}if(s){const r=s.closest(`.${o}`).getAttribute("col-index"),l=t.columns[r];l.elMenuList?t.destroyHeaderCellMenuList(l):(t.destroyHeaderCellMenuList(),requestAnimationFrame((()=>{t.showHeaderCellMenuList(e,l,r)})))}}},renderVisibleHeaderCells(){const e=this;let t=e.scroller.columnViewStart,o=e.scroller.columnViewEnd;for(let r=t;r<=o;r++){if(e.columns[r].hidden)continue;const t=e.createHeaderCell(r);e.headerInnerContainerEl.appendChild(t)}},appendHeaderCell(e){const t=this.headerInnerContainerEl,o=this.createHeaderCell(e);t.appendChild(o)},createHeaderCell(e){const u=this,p=u.columns[e],h=L(o,{width:p.width+"px",left:p.left+"px"}),g=p.title;p.sortable&&p.type&&h.classList.add(s),!1===p.resizable&&h.classList.add(i),h.setAttribute("col-index",e),h.setAttribute("col-id",p.id);const m=L(r),C=L(a);C.innerHTML=g;const y=G(w),S=G(d);Object.entries(p.filters||{}).length||S.classList.add(t),S.innerHTML=Fancy.svg.filter,y.appendChild(S),p.elFilter=S;const b=G(I),A=G(R);p.sortOrder?A.innerHTML=p.sortOrder:A.classList.add(t),b.appendChild(A),p.elSortOrder=A;const D=G(E);"ASC"!==p.sort&&D.classList.add(t),D.innerHTML=Fancy.svg.sortAsc,b.appendChild(D),p.elSortAsc=D;const F=G();F.classList.add(f),"DESC"!==p.sort&&F.classList.add(t),F.innerHTML=Fancy.svg.sortDesc,b.appendChild(F),p.elSortDesc=F;const M=L(c);M.addEventListener("mousedown",u.onResizeMouseDown.bind(this)),m.appendChild(C),m.appendChild(y),m.appendChild(b);const T=L(l);if(T.innerHTML=Fancy.svg.menu,p.elMenu=T,p.headerCheckboxSelection&&p.checkboxSelection){const e=L(n),t=x(v);t.setAttribute("type","checkbox"),t.addEventListener("click",u.onHeaderCheckboxSelectionClick.bind(this)),e.appendChild(t),p.headerCheckboxSelectionEl=t,h.appendChild(e),u.updateHeaderCheckboxSelection(p)}return h.appendChild(m),!1!==p.menu&&h.appendChild(T),!1!==p.resizable&&h.appendChild(M),h.addEventListener("mousedown",u.onCellMouseDown.bind(this)),p.headerCellEl=h,h},onCellMouseDown(e){const t=this;if(e.target.closest(`.${l}`))return;const r=e.target.classList.contains(o)?e.target:e.target.closest(`.${o}`),n=Number(r.getAttribute("col-index")),s=t.columns[n];!1!==s.draggable&&(t.columnDragDownX=e.pageX,t.columnDragDownY=e.pageY,t.columnDragMouseDownColumn=s,t.columnDragMouseDownColumnIndex=n,t.onColumnDragMouseMoveFn=t.onColumnDragMouseMove.bind(this),document.addEventListener("mousemove",t.onColumnDragMouseMoveFn),document.addEventListener("mouseup",(()=>{delete t.columnDragDownX,delete t.columnDragDownY,delete t.columnDragMouseDownColumn,delete t.debouceColumnDraggingFn,setTimeout((()=>{t.activeRowGroupBarItemEl&&t.activeRowGroupBarItemEl.classList.remove(y),t.gridEl.classList.remove(h),t.columnDragging?.dragColumnCellEl.remove(),delete t.columnDragging,t.$requiresReSetGroupColumn&&"column"===t.rowGroupType&&(delete t.$requiresReSetGroupColumn,1===t.rowGroupBarItemColumns.length&&setTimeout((()=>{let e=0;t.$rowGroupColumn.hidden=!0,"order"===t.columns[0].type?(t.columns.splice(1,0,t.$rowGroupColumn),e=1):t.columns.unshift(t.$rowGroupColumn),t.scroller.generateNewRange(!1),t.reSetVisibleHeaderColumnsIndex(),t.showColumn(t.columns[e])}),1)),t.rowGroupBarItemColumns&&t.rowGroupBarItemColumns.length!==t.store.rowGroups.length&&t.reConfigRowGroups()}),1),document.removeEventListener("mousemove",t.onColumnDragMouseMoveFn)}),{once:!0}))},onResizeMouseDown(e){const t=this,r=e.target.closest(`.${o}`),l=Number(r.getAttribute("col-index")),n=t.columns[l];e.preventDefault(),e.stopPropagation(),!1!==n.resizable&&(t.columnResizing=!0,t.resizeDownX=e.pageX,t.resizeDownColumnWidth=n.width,t.resizeDownColumnIndex=l,t.onResizeMouseMoveFn=t.onResizeMouseMove.bind(this),document.addEventListener("mouseup",t.onResizeMouseUp.bind(this),{once:!0}),document.body.addEventListener("mousemove",t.onResizeMouseMoveFn),t.gridEl.classList.add(p),t.gridEl.style.cursor="ew-resize",t.gridEl.style.userSelect="none",t.gridEl.querySelectorAll(`.${o}`).forEach((e=>{e.style.cursor="ew-resize"})),t.gridEl.querySelectorAll(`.${u}`).forEach((e=>{e.style.cursor="ew-resize"})))},onResizeMouseUp(){const e=this;e.columnResizing=!1,e.gridEl.classList.remove(p),e.gridEl.style.cursor="",e.gridEl.style.userSelect="",document.body.querySelectorAll(`.${o}`).forEach((e=>{e.style.cursor=""})),e.gridEl.querySelectorAll(`.${u}`).forEach((e=>{e.style.cursor=""})),document.body.removeEventListener("mousemove",e.onResizeMouseMoveFn)},onResizeMouseMove(e){const t=this,o=e.pageX-t.resizeDownX,r=t.columns[t.resizeDownColumnIndex],l=r.minWidth||t.minColumnWidth;let n=t.resizeDownColumnWidth+o;n<l&&(n=l),r.width=n,requestAnimationFrame((()=>{t.reCalcColumnsPositions(),t.updateCellPositions(t.resizeDownColumnIndex),t.updateWidth()}))},updateHeaderCells(){const e=this;let o=e.scroller.columnViewStart,r=e.scroller.columnViewEnd;for(let l=o;l<=r;l++){const o=e.columns[l];o.hidden||(Object.entries(o.filters||{}).length?o.elFilter.classList.remove(t):o.elFilter.classList.add(t),o.sortOrder?(o.elSortOrder.innerHTML=o.sortOrder,o.elSortOrder.classList.remove(t)):o.elSortOrder.classList.contains(t)||o.elSortOrder.classList.add(t),"ASC"===o.sort?o.elSortAsc.classList.remove(t):o.elSortAsc.classList.contains(t)||o.elSortAsc.classList.add(t),"DESC"===o.sort?o.elSortDesc.classList.remove(t):o.elSortDesc.classList.contains(t)||o.elSortDesc.classList.add(t))}},showHeaderCellMenuList(e,t){const o=this,r=t.elMenu.getBoundingClientRect(),l=r.top-1+r.height,n=r.left,s=L([g,"fg-theme-"+o.theme],{top:`${l}px`,left:`${n}px`});s.innerHTML=o.columns.map(((e,t)=>e.$isRowGroupColumn?"":[`<div col-index="${t}" class="${m}">`,`<input type="checkbox" ${e.hidden?"":"checked"}>`,`<div class="${C}">${e.title}</div>`,"</div>"].join(""))).join(""),t.elMenuList=s,document.body.appendChild(s),setTimeout((()=>{s.style.opacity="1",o.activeElMenuList=s}),0),s.addEventListener("click",o.onClickHeaderMenuItem.bind(this)),o.onDocClickForHeaderCellMenuFn=o.onDocClickForHeaderCellMenu.bind(this,t),document.addEventListener("mousedown",o.onDocClickForHeaderCellMenuFn)},onClickHeaderMenuItem(t){const o=this,r=t.target.closest(`.${m}`);if(r&&!o.animatingColumnsPosition){const l=r.querySelector("input"),n=Number(r.getAttribute("col-index")),s=o.columns[n],i="input"===t.target.tagName.toLowerCase();if(!o.isPossibleToHideColumn()&&(!i&&l.checked||i&&!l.checked))return i&&t.preventDefault(),void console.warn("Hiding column was prevented because it requires at least 1 visible column");o.animatingColumnsPosition=!0,o.gridEl.classList.add(e),i||(l.checked=!l.checked),l.checked?o.showColumn(s):o.hideColumn(s),setTimeout((()=>{o.gridEl.classList.remove(e),delete o.animatingColumnsPosition}),300)}},onDocClickForHeaderCellMenu(e,t){const o=this;t.target.closest(`.${g}`)||t.target.closest(`.${l}`)||o.destroyHeaderCellMenuList(e)},destroyHeaderCellMenuList(e){const t=this;document.removeEventListener("mousedown",t.onDocClickForHeaderCellMenuFn),e?(e.elMenuList?.remove(),delete e.elMenuList):t.activeElMenuList&&t.scroller.columnsViewRange.forEach((e=>{const o=t.columns[e];o.elMenuList&&(o.elMenuList.remove(),delete o.elMenuList)})),delete t.activeElMenuList},reSetVisibleHeaderColumnsIndex(){const e=this,t=e.scroller.columnsViewRange;for(let o=0,r=t.length;o<r;o++){const r=t[o],l=e.columns[r],n=l.headerCellEl,s=l.filterCellEl;l.hidden||(n&&Number(n.getAttribute("col-index"))!==r&&n.setAttribute("col-index",r),s&&Number(s.getAttribute("col-index"))!==r&&s.setAttribute("col-index",r))}}};Object.assign(Grid.prototype,S)})(),(()=>{const{CELL:e,CELL_VALUE:t,CELL_ORDER:o,CELL_WRAPPER:r,CELL_SELECTION:l,CELL_SELECTED:n,ACTIVE_CELL:s,ACTIVE_CELL_ROW:i,ROW:a,ROW_ODD:d,ROW_EVEN:c,ROW_SELECTED:u,ROW_GROUP:p,ROW_GROUP_VALUE_CELL:h,ROW_GROUP_CELL:g,ROW_GROUP_CELL_SELECTION:m,ROW_GROUP_CELL_VALUE:C,ROW_GROUP_CELL_AMOUNT:w,ROW_GROUP_CELL_EXPANDER:E,ROW_GROUP_EXPANDED_CELL:f,ROW_HOVER:R,INPUT_CHECKBOX:I,SVG_ITEM:v,SVG_CHEVRON_RIGHT:y}=Fancy.cls,{div:L,span:G,input:x}=Fancy,S={addColumnCells(e=[]){const t=this,o=t.scroller.getStartRow(),r=t.scroller.getEndRow();e.forEach((e=>{let l=o;for(t.appendHeaderCell(e),t.filterBar&&t.appendFilterBarCell(e);l<r;l++)t.appendCell(l,e)}))},appendCell(e,t){const o=this,r=o.store.getItemByRowIndex(e),l=o.renderedRowsIdMap.get(r.id);if(l.classList.contains(p)){const n=o.columns[t];if("column"===o.rowGroupType&&n.$isRowGroupColumn){const n=o.createCellGroupTypeColumn(e,r,t);l.appendChild(n)}return}const n=o.createCell(e,t);l.appendChild(n)},createCell(o,i){const a=this,d=a.store,c=d.getItemByRowIndex(o),u=a.columns[i];let p,g=c[u.index];const m=L(e,{width:u.width+"px",left:u.left+"px"}),C={item:c,column:u,rowIndex:o,columnIndex:i,value:g,cell:m};if("currency"===u.$type&&(u.currency&&(C.currency=u.currency),void 0!==u.minDecimal&&(C.minDecimal=u.minDecimal),void 0!==u.maxDecimal&&(C.maxDecimal=u.maxDecimal)),m.setAttribute("col-index",i),m.setAttribute("col-id",u.id),a.activeCell&&!0!==a.$preventActiveCellRender&&c.id===a.activeCellRowId&&i===a.activeCellColumnIndex&&(m.classList.add(s),a.activeCellEl=m),u.cellStyle){let e;switch(typeof u.cellStyle){case"function":e=u.cellStyle(C)||{};break;case"object":e=u.cellStyle}for(const t in e)m.style[t]=e[t]}if(u.cellCls)if("string"==typeof u.cellCls)m.classList.add(u.cellCls);else if(Array.isArray(u.cellCls))m.classList.add(...u.cellCls);else if("function"==typeof u.cellCls){let e=u.cellCls(C);"string"==typeof e&&(e=[e]),e&&m.classList.add(...e)}if(u.cellClsRules)for(const e in u.cellClsRules)(0,u.cellClsRules[e])(C)&&m.classList.add(e);if(u.format&&(g=u.format(C)),p=u.render?u.render(C):g,(u.$isRowGroupColumn||u.rowGroupIndent)&&m.classList.add(h),u.checkboxSelection){const e=L(r);u.rowGroupIndent&&e.style.setProperty("--grid-group-level",`${d.rowGroups.length+1}`);const t=a.generateRowGroupCheckBoxEl(c);t.addEventListener("click",this.onRowCellSelectionClick.bind(this)),e.appendChild(t);const o=a.generateSimpleValueEl(p);e.appendChild(o),m.appendChild(e),m.classList.add(l)}else if(u.$isRowGroupColumn){const e=L(r);u.rowGroupIndent&&e.style.setProperty("--grid-group-level",`${d.rowGroups.length}`);const o=G(t);""===p&&(p="&nbsp;"),o.innerHTML=p??"&nbsp;",e.appendChild(o),m.appendChild(e)}else void 0!==p&&(""===p&&(p="&nbsp;"),m.innerHTML=p??"&nbsp;");return a.activeCell&&(m.addEventListener("mousedown",a.onBodyCellMouseDown.bind(this)),a.selectingCells&&(m.addEventListener("mouseenter",a.onBodyCellMouseEnter.bind(this)),a.selectionCellsRange&&m&&requestAnimationFrame((()=>{a.isCellInSelectedRange(m)&&m.classList.add(n)})))),u.editable&&m.addEventListener("dblclick",a.onBodyCellDBLClick.bind(this)),m.addEventListener("click",a.onBodyCellClick.bind(this)),m},createCellGroupTypeColumn(t,o,r){const l=this,n=l.columns[r];if(n.$isRowGroupColumn){const e=l.generateGroupCell(t,o,n);return e.setAttribute("col-index",r),e.setAttribute("col-id",n.id),e.style.left=n.left+"px",e.style.width=n.width+"px",e}{const n=l.columns[r];let s=o.$agValues[n.index]||"";const i=L(e,{width:n.width+"px",left:n.left+"px"});let a;return n.format&&(s=n.format({item:o,column:n,rowIndex:t,columnIndex:r,value:s,cell:i})),a=n.render?n.render({item:o,column:n,rowIndex:t,columnIndex:r,value:s,cell:i}):s,i.setAttribute("col-index",r),i.setAttribute("col-id",n.id),void 0!==a&&(i.innerHTML=a),i}},createCellGroupTypeRow(e,t){const o=this.generateGroupCell(e,t);return o.style.left="0px",o},generateSimpleValueEl(e){const o=G(t);return""===e&&(e="&nbsp;"),o.innerHTML=e??"&nbsp;",o},generateGroupCell(e,t,o={}){const r=this,n=L(g);t.expanded&&n.classList.add(f);const s=r.generateRowGroupExpanderEl(t);if(n.appendChild(s),r.checkboxSelection||o.checkboxSelection){const e=r.generateRowGroupSelectionEl(t);n.appendChild(e),n.classList.add(l)}const i=r.generateValueEl(t,e);n.appendChild(i);const a=r.generateAmountEl(t);return n.appendChild(a),n},generateAmountEl(e){const t=G(w);return t.innerHTML=` (${e.amount})`,t},generateValueEl(e,t){const o=e.$rowDisplayGroupValue,r=G(C);if(this.groupValueRender){const l=this.groupValueRender({el:r,value:o,item:e,rowIndex:t});l&&(r.innerHTML=l)}else r.innerHTML=o;return r},generateRowGroupExpanderEl(e){const t=Fancy.svg.chevronRight,o=G([E,v,y]);return o.style.setProperty("--grid-group-level",e.$groupLevel),o.innerHTML=t,o.addEventListener("click",this.onRowGroupExpanderClick.bind(this)),o},generateRowGroupCheckBoxEl(e){const t=e.$selected||!1,o=x(I);return o.setAttribute("type","checkbox"),o.checked=t,"partly"===e.selectedStatus&&(o.indeterminate=!0),o},generateRowGroupSelectionEl(e){const t=G(m),o=this.generateRowGroupCheckBoxEl(e);return o.addEventListener("click",this.onRowGroupCellSelectionClick.bind(this)),t.appendChild(o),t},removeColumnCells(e=[]){const t=this;e.forEach((e=>{const o=t.headerEl.querySelector(`[col-index="${e}"]`);if(o){if(o.remove?.(),t.filterBar){const o=t.filterBarEl.querySelector(`[col-index="${e}"]`);o.remove?.()}t.renderedRowsIdMap.forEach((t=>{if(t.classList.contains(p))return;const o=t.querySelector(`[col-index="${e}"]`);o?.remove()}))}}))},renderRow(e,t,o={}){const r=this;if(!t)return void console.warn(`row ${e} does not exist`);const l=L(a,{transform:`translateY(${e*r.rowHeight}px)`,...o}),n={rowIndex:e,item:t};l.classList.add(e%2==1?d:c),r.activeCell&&!0!==r.$preventActiveCellRender&&t.id===r.activeCellRowId&&(l.classList.add(i),r.activeCellRowEl=l),r.applyExtraRowStyles(l,n),t.$selected&&l.classList.add(u),l.setAttribute("row-id",t.id),l.setAttribute("row-index",e),l.addEventListener("mouseenter",this.onRowMouseEnter.bind(this));let s=r.scroller.columnViewStart,p=r.scroller.columnViewEnd;for(let t=s;t<=p;t++){const o=r.createCell(e,t);!r.columns[t].hidden&&l.appendChild(o)}return r.bodyInnerContainerEl.appendChild(l),r.renderedRowsIdMap.set(t.id,l),l},applyExtraRowStyles(e,t){const o=this;if(o.rowStyle&&"function"==typeof o.rowStyle){const r=o.rowStyle(t)||{};for(const t in r)e.style[t]=r[t]}if(o.rowCls&&"function"==typeof o.rowCls){let r=o.rowCls(t)||[];"string"==typeof r&&(r=[r]),e.classList.add(...r)}if(o.rowClsRules&&"object"==typeof o.rowClsRules)for(const r in o.rowClsRules)(0,o.rowClsRules[r])(t)&&e.classList.add(r)},renderRowGroup(e,t,o={}){const r=this,l=r.rowGroupType;if(!t)return void console.warn(`row ${e} does not exist`);const n=L(p,o);if(n.classList.add(e%2==1?d:c),t.$selected&&n.classList.add(u),n.style.transform=`translateY(${e*r.rowHeight}px)`,n.setAttribute("row-id",t.id),n.setAttribute("row-index",e),n.setAttribute("row-group",t.$rowGroupValue.replaceAll("-","$").split("/").join("-")),n.addEventListener("mouseenter",this.onRowMouseEnter.bind(this)),"column"===l){let o=r.scroller.columnViewStart,l=r.scroller.columnViewEnd;for(let s=o;s<=l;s++)if(!r.columns[s].hidden){const o=r.createCellGroupTypeColumn(e,t,s);n.appendChild(o)}}else if("row"===l){const o=r.createCellGroupTypeRow(e,t);n.appendChild(o)}return r.bodyInnerContainerEl.appendChild(n),r.renderedRowsIdMap.set(t.id,n),n},renderRowOnPrevPosition(e,t){const o=this;if(!e)return void console.warn(`row ${e.index} does not exist`);const r=L(a),l=o.store.prevIdRowIndexesMap.get(e.id),n=e.rowIndex;let s;s=t?o.getSmoothPositionY(e,!0):l*o.rowHeight,e.$selected&&r.classList.add(u);const i={rowIndex:n,item:e};r.classList.add(n%2==1?d:c),o.applyExtraRowStyles(r,i),r.style.transform=`translateY(${s}px)`,r.setAttribute("row-id",e.id),r.setAttribute("row-index",n),r.addEventListener("mouseenter",this.onRowMouseEnter.bind(this));let p=o.scroller.columnViewStart,h=o.scroller.columnViewEnd;for(let e=p;e<=h;e++){if(o.columns[e].hidden)continue;const t=o.createCell(n,e);r.appendChild(t)}o.bodyInnerContainerEl.appendChild(r),o.renderedRowsIdMap.set(e.id,r)},updateCellPositions(t){const o=this;let r=o.scroller.columnViewStart,l=o.scroller.columnViewEnd;void 0!==t&&r<t&&(r=t);for(let e=r;e<=l;e++){const t=o.columns[e];t.hidden||(t.headerCellEl||o.appendHeaderCell(e),t.headerCellEl.style.left=t.left+"px",t.headerCellEl.style.width=t.width+"px",t.filterCellEl&&(t.filterCellEl.style.left=t.left+"px",t.filterCellEl.style.width=t.width+"px"))}o.renderedRowsIdMap.forEach(((t,r)=>{t.querySelectorAll(`.${e}`).forEach((e=>{const t=e.getAttribute("col-index"),r=o.columns[t];e.style.left=r.left+"px",e.style.width=r.width+"px"})),"column"===o.rowGroupType&&t.querySelectorAll(`.${g}`).forEach((e=>{const t=e.getAttribute("col-index"),r=o.columns[t];e.style.left=r.left+"px",e.style.width=r.width+"px"}))}))},renderVisibleRows(){const e=this,t=e.scroller.getStartRow(),o=e.scroller.getEndRow();e.actualRowsIdSet=new Set;let r=t;for(;r<o;r++){const t=e.store.getItemByRowIndex(r);t?(e.renderedRowsIdMap.has(t.id)||(t.$isGroupRow?e.renderRowGroup(r,t):e.renderRow(r,t)),e.actualRowsIdSet.add(t.id)):console.warn(`Item with index equals to ${r} does not exist`)}},terminateVisibleRows(){const e=this;e.renderedRowsIdMap.forEach(((t,o)=>{e.removeDomRowById(o)}))},fakeHideRow(e){const t=this.renderedRowsIdMap.get(e.id);t?t.style.opacity="0":console.warn(`Row el for row index ${e.rowIndex} does not exist`)},fakeRowPosition(e){const t=this,r=t.renderedRowsIdMap.get(e.id);if(!r)return void console.warn(`Row el for row index ${e.rowIndex} does not exist`);const l=t.getSmoothPositionY(e);if(r.style.transform=`translateY(${l}px)`,r.setAttribute("row-index",e.rowIndex),t.columnOrder){const t=r.querySelector(`.${o}`);t&&(t.innerHTML=e.rowIndex+1)}},getSmoothPositionY(e,t){const o=this,r=o.rowHeight*o.scroller.bufferRows;let l=e.rowIndex;t&&(l=o.store.prevIdRowIndexesMap.get(e.id));let n=l*o.rowHeight;return n<o.scroller.scrollTop-r?n=o.scroller.scrollTop-r:n>o.scroller.scrollTop+o.height+r&&(n=o.scroller.scrollTop+o.height+r),n},updateRowPosition(e){const t=this.renderedRowsIdMap.get(e.id);t?(t.style.transform=`translateY(${e.rowIndex*this.rowHeight}px)`,t.setAttribute("row-index",e.rowIndex)):console.warn(`Row el for row index ${e.rowIndex} does not exist`)},removeNotNeededRows(){const e=this;e.renderedRowsIdMap.forEach(((t,o)=>{e.actualRowsIdSet.has(o)||e.removeDomRowById(o)}))},onRowMouseEnter(e){this.columnResizing||(e.target.classList.add(R),e.target.addEventListener("mouseleave",this.onRowMouseLeave.bind(this),{once:!0}))},onRowMouseLeave(e){e.target.classList.remove(R)},onRowGroupExpanderClick(e){const t=this;if(t.grouping)return;const o=e.target.closest(`.${g}`),r=o.closest(`.${p}`).getAttribute("row-group").replaceAll("-","/").replaceAll("$","-");o.classList.contains(f)?t.collapse(r):t.expand(r)},updateRowGroupCellExpandedCls(e){const t=this.bodyEl.querySelector(`div[row-group="${e.replaceAll("-","$").replaceAll("/","-")}"] .${g}`);t.classList.contains(f)?t.classList.remove(f):t.classList.add(f)},updateAllRowGroupCellsExtendedCls(){const e=this;e.bodyEl.querySelectorAll(`.${p}`).forEach((t=>{const o=t.getAttribute("row-group").replaceAll("-","/").replaceAll("$","-"),r=t.querySelector(`.${g}`),l=e.store.expandedGroups[o],n=r.classList.contains(f);l&&!n?r.classList.add(f):!l&&n&&r.classList.remove(f)}))},reSetVisibleBodyColumnsIndex(t,o,r){const l=this,n={},s={};if(void 0!==t){for(let r=t;r<=o;r++){const t=l.bodyEl.querySelectorAll(`.${e}[col-index="${r}"]`);if(n[r]=t,"column"===l.rowGroupType){const e=l.bodyEl.querySelectorAll(`.${g}[col-index="${r}"]`);e.length&&(s[r]=e)}}for(let e=t,l=0;e<=o;e++,l++){const e=r[l],o=t+l;n[e].forEach((e=>{e.setAttribute("col-index",o)})),s[e]?.forEach((e=>{e.setAttribute("col-index",o)}))}}else{const t=l.scroller.columnsViewRange;for(let o=0,r=t.length;o<r;o++){const r=t[o],n=l.columns[r];l.bodyEl.querySelectorAll(`.${e}[col-id="${n.id}"]`).forEach((e=>{Number(e.getAttribute("col-index"))!==r&&e.setAttribute("col-index",r)})),"column"===l.rowGroupType&&l.bodyEl.querySelectorAll(`.${g}[col-index="${o}"]`).forEach((e=>{Number(e.getAttribute("col-index"))!==r&&e.setAttribute("col-index",r)}))}}},getCell(t,o){return this.bodyEl.querySelector(`div.${a}[row-index="${t}"] div.${e}[col-index="${o}"]`)},updateOrderColumn(){const e=this;e.columnOrder&&e.bodyEl.querySelectorAll(`div.${o}`).forEach((t=>{const o=t.closest(`.${a}`);if(!o)return;const r=o.getAttribute("row-id"),l=e.store.idItemMap.get(r);l&&(t.innerHTML=l.rowIndex+1)}))}};Object.assign(Grid.prototype,S)})(),(()=>{const e={initScroller(){this.scroller=new Fancy.Scroller({grid:this})},onMouseWheel(e){const t=this,o="wheelDelta"in e?e.wheelDelta:e.deltaY;let r=!1;t.wheelScrolling=!0,Math.abs(e.deltaY)>Math.abs(e.deltaX)?(r=t.scroller.deltaChange(o),t.bodyInnerEl.scrollTop=t.scroller.scrollTop):(r=t.scroller.horizontalDeltaChange(o),t.bodyInnerEl.scrollLeft=t.scroller.scrollLeft),r&&e.preventDefault(),cancelAnimationFrame(t.animationRenderId),t.animationRenderId=requestAnimationFrame((()=>{t.renderVisibleRows()})),cancelAnimationFrame(t.animationRemoveId),t.animationRemoveId=requestAnimationFrame((()=>{t.removeNotNeededRows()})),t.debouceClearWheelScrollingFn()},onTouchScroll(e){const t=this;let o=!1;t.wheelScrolling=!0,Math.abs(e.deltaY)>Math.abs(e.deltaX)?(o=t.scroller.deltaChange(e.deltaY),t.bodyInnerEl.scrollTop=t.scroller.scrollTop):e.deltaX&&(o=t.scroller.horizontalDeltaChange(e.deltaX),t.bodyInnerEl.scrollLeft=t.scroller.scrollLeft),o&&e.preventDefault?.(),cancelAnimationFrame(t.animationRenderId),t.animationRenderId=requestAnimationFrame((()=>{t.renderVisibleRows()})),cancelAnimationFrame(t.animationRemoveId),t.animationRemoveId=requestAnimationFrame((()=>{t.removeNotNeededRows()})),t.debouceClearWheelScrollingFn()},clearWheelScrolling(){delete this.wheelScrolling}};Object.assign(Grid.prototype,e)})(),(()=>{const e={sort(e,t="ASC",o){const r=this;if(r.sorting)return;r.isEditing&&r.hideActiveEditor(),r.sorting=!0;let l={};r.store.sort(e,t,o),o&&r.store.sorters.forEach(((e,t)=>{l[e.column.id]=t+1})),r.columns.forEach((n=>{n.id===e.id?(n.sort=t,o&&1!==r.store.sorters.length?n.sortOrder=l[n.id]:delete n.sortOrder):(o||delete n.sort,l[n.id]?n.sortOrder=l[n.id]:delete n.sortOrder)})),r.renderVisibleRowsAfterSort(),r.store.memorizePrevRowIndexesMap(),r.updateHeaderCells(),r.activeCell&&r.clearActiveCell()},multiSort(e,t){this.sort(e,t,!0)},clearSort(e,t){const o=this;let r=0;for(;r<o.columns.length;r++){const l=o.columns[r];e&&t?l.id===e.id&&(delete l.sort,delete l.sortOrder):(delete l.sort,delete l.sortOrder)}o.store.clearSort(e,t),o.renderVisibleRowsAfterSort(),o.store.memorizePrevRowIndexesMap(),o.updateHeaderCells(),o.activeCell&&o.clearActiveCell()},renderVisibleRowsAfterSort(){const e=this,t=e.scroller.getStartRow(),o=e.scroller.getEndRow();e.actualRowsIdSet=new Set;let r=t;for(;r<o;r++){const t=e.store.getItemByRowIndex(r);t?(e.renderedRowsIdMap.has(t.id)||e.renderRowOnPrevPosition(t,!0),e.actualRowsIdSet.add(t.id)):console.warn(`Item with index equals to ${r} does not exist`)}const l=[];requestAnimationFrame((()=>{requestAnimationFrame((()=>{e.renderedRowsIdMap.forEach(((t,o)=>{const r=e.store.idItemMap.get(o);e.actualRowsIdSet.has(r.id)||l.push(r),e.fakeRowPosition(r)})),clearTimeout(e.timeOutRemoveRows),e.timeOutRemoveRows=setTimeout((()=>{l.forEach((t=>{e.removeDomRowById(t.id)})),e.sorting=!1}),500)}))}))}};Object.assign(Grid.prototype,e)})(),(()=>{const{FILTER_BAR:e,FILTER_BAR_CELL:t,FILTER_BAR_INNER:o,FILTER_BAR_INNER_CONTAINER:r}=Fancy.cls,l=Fancy.div,n={renderVisibleFilterBarCells(){const e=this;let t=e.scroller.columnViewStart,o=e.scroller.columnViewEnd;for(let r=t;r<=o;r++){if(e.columns[r].hidden)continue;const t=e.createFilterBarCell(r);e.filterBarInnerContainerEl.appendChild(t)}},renderFilterBar(){const t=this,n=l(e,{height:this.headerRowHeight+1+"px"}),s=l(o,{width:t.getTotalColumnsWidth()+t.scroller.scrollBarWidth+"px"}),i=l(r,{height:t.headerRowHeight+"px",width:t.getTotalColumnsWidth()+"px"});s.appendChild(i),n.appendChild(s),t.gridEl.appendChild(n),t.filterBarInnerContainerEl=i,t.filterBarInnerEl=s,t.filterBarEl=n},createFilterBarCell(e){const o=this,r=o.columns[e],n=l(t,{width:r.width+"px",left:r.left+"px"});if(n.setAttribute("col-index",e),n.setAttribute("col-id",r.id),r.filter){const e=Object.entries(r.filters||{});let t="",l="";e.length&&(t=e[0][0],l=e[0][1].value);const s=new Fancy.FilterField({renderTo:n,onChange:o.onFilterFieldChange.bind(this),column:r,sign:t,value:l});r.filterField=s}return r.filterCellEl=n,n},onFilterFieldChange(e,t,o){const r=this;o.filters={},""===e?r.clearFilter(o,t):r.filter(o,e,t)},appendFilterBarCell(e){const t=this.filterBarInnerContainerEl,o=this.createFilterBarCell(e);t.appendChild(o)},clearFilter(e,t){const o=this,r=o.store;if(r.rowGroups.length)return o.beforeGrouping(),r.clearFilterForGrouping(e,t),o.afterGrouping(),o.updateRowGroupAmount(),void o.updateHeaderCells();r.clearFilter(e,t),o.columns.forEach((o=>{o.index===e&&(t&&o.filters?delete o.filters[t]:delete o.filters)})),o.updateAfterFilter()},filter(e,t,o="="){const r=this,l=r.store;if(l.rowGroups.length)return r.beforeGrouping(),r.filterForRowGrouping(e,t,o),r.afterGrouping(),r.updateRowGroupAmount(),void r.updateHeaderCells();l.filter(e,t,o),r.updateFiltersInColumns(e,t,o),r.updateAfterFilter()},filterForRowGrouping(e,t,o="="){this.store.filterForRowGrouping(e,t,o),this.updateFiltersInColumns(e,t,o)},updateFiltersInColumns(e,t,o){this.columns.forEach((r=>{r.index===e&&(r.filters=r.filters||{},r.filters[o]=r.filters[o]||{},r.filters[o].value=t)}))},updateAfterFilter(){const e=this;e.scroller.calcMaxScrollTop(),e.scroller.updateScrollTop(),e.scroller.calcViewRange(),e.scroller.setVerticalSize(),e.scroller.updateHorizontalScrollSize(),e.updateVisibleHeight(),e.renderVisibleRowsAfterFilter(),e.store.memorizePrevRowIndexesMap(),e.updateHeaderCells()},renderVisibleRowsAfterFilter(){const e=this,t=e.scroller.getStartRow(),o=e.scroller.getEndRow();e.actualRowsIdSet=new Set;let r=t;for(;r<o;r++){const t=e.store.getItemByRowIndex(r);t?(!e.renderedRowsIdMap.has(t.id)&&e.renderRowOnPrevPosition(t,!0),e.actualRowsIdSet.add(t.id)):console.warn(`Item with index equals to ${r} does not exist`)}const l=[];requestAnimationFrame((()=>{requestAnimationFrame((()=>{e.renderedRowsIdMap.forEach(((t,o)=>{const r=e.store.idItemMap.get(o);e.actualRowsIdSet.has(r.id)?e.fakeRowPosition(r):(l.push(r),e.fakeHideRow(r))})),clearTimeout(e.timeOutRemoveRows),e.timeOutRemoveRows=setTimeout((()=>{l.forEach((t=>{e.removeDomRowById(t.id)})),e.filtering=!1}),500)}))}))}};Object.assign(Grid.prototype,n)})(),(()=>{const{ROW_GROUP:e,ROW_GROUP_CELL_AMOUNT:t}=Fancy.cls,o={toggleExpand(e){const t=this;t.beforeGrouping(),t.grouping||(t.store.toggleExpand(e),t.afterGrouping())},expand(e){const t=this;t.grouping||(t.beforeGrouping(),t.grouping=!0,t.store.filters.length?t.store.expandForFiltering(e):t.store.expand(e),t.updateRowGroupCellExpandedCls(e),t.afterGrouping())},expandAll(){const e=this;e.beforeGrouping(),e.grouping||(e.grouping=!0,e.store.expandAll(),e.updateAllRowGroupCellsExtendedCls(),e.afterGrouping())},collapse(e){const t=this;t.beforeGrouping(),t.grouping||(t.grouping=!0,t.store.filters.length?t.store.collapseForFiltering(e):t.store.collapse(e),t.updateRowGroupCellExpandedCls(e),t.afterGrouping())},collapseAll(){const e=this;e.beforeGrouping(),e.grouping||(e.grouping=!0,e.store.collapseAll(),e.updateAllRowGroupCellsExtendedCls(),e.afterGrouping())},beforeGrouping(){const e=this;e.isEditing&&e.hideActiveEditor(),e.activeCell&&e.clearActiveCell()},afterGrouping(){const e=this;e.scroller.calcMaxScrollTop(),e.scroller.updateScrollTop(),e.scroller.calcViewRange(),e.scroller.setVerticalSize(),e.scroller.updateHorizontalScrollSize(),e.updateVisibleHeight(),e.renderVisibleRowsAfterGrouping(),e.store.memorizePrevRowIndexesMap()},renderVisibleRowsAfterGrouping(){const e=this,t=e.scroller.getStartRow(),o=e.scroller.getEndRow(),r=[];e.actualRowsIdSet=new Set;let l=t;for(;l<o;l++){const t=e.store.getItemByRowIndex(l);t?(e.renderedRowsIdMap.has(t.id)||(t.$isGroupRow?r.push(e.renderRowGroup(l,t,{"z-index":0,opacity:0})):r.push(e.renderRow(l,t,{"z-index":0,opacity:0}))),e.actualRowsIdSet.add(t.id)):console.warn(`Item with index equals to ${l} does not exist`)}const n=[];requestAnimationFrame((()=>{requestAnimationFrame((()=>{e.renderedRowsIdMap.forEach(((t,o)=>{const r=e.store.idItemMap.get(o);e.actualRowsIdSet.has(r.id)||n.push(r),e.updateRowPosition(r),e.fakeRowPosition(r)})),n.forEach((t=>{const o=e.renderedRowsIdMap.get(t.id);o.style.zIndex="0",o.style.opacity="0"})),clearTimeout(e.timeOutRemoveRows),r.forEach((e=>{e.style.opacity=1})),e.timeOutRemoveRows=setTimeout((()=>{n.forEach((t=>{e.removeDomRowById(t.id)})),r.forEach((e=>{e.style["z-index"]="",e.style.opacity=""})),e.grouping=!1}),500)}))}))},updateRowGroupAmount(){const o=this.store,r=o.filters;this.bodyEl.querySelectorAll(`.${t}`).forEach((t=>{const l=t.closest(`.${e}`).getAttribute("row-group").replaceAll("-","/").replaceAll("$","-"),n=r.length?o.groupDetailsForFiltering[l]:o.groupDetails[l];if(!n)return;let s=` (${n.amount})`;Number(t.innerHTML)!==n.amount&&(t.innerHTML=s)}))},updateRowGroupAggregations(){const t=this,o=t.store,r=o.filters;"row"!==t.rowGroupType&&o.aggregations.forEach((l=>{t.bodyEl.querySelectorAll(`.${e}`).forEach((e=>{const n=e.getAttribute("row-group").replaceAll("-","/").replaceAll("$","-"),s=r.length?o.groupDetailsForFiltering[n]:o.groupDetails[n];if(!s)return;const i=t.getItemById(s.id),a=e.querySelector(`div[col-id="${l.index}"]`),d=Number(a.getAttribute("col-index")),c=e?.getAttribute("row-index"),u=t.createCellGroupTypeColumn(c,i,d);a.innerHTML!=u.innerHTML&&(a.remove(),e.appendChild(u))}))}))},reConfigRowGroups(){const e=this,t=e.store;let o=[];e.grouping=!0,e.terminateVisibleRows(),void 0!==e.rowGroupBarItemColumns?.length?e.rowGroupBarItemColumns.forEach((e=>{o.push(e.index)})):o=t.rowGroups,t.reConfigRowGroups(o),e.scroller.calcMaxScrollTop(),e.scroller.updateScrollTop(),e.scroller.calcViewRange(),e.scroller.setVerticalSize(),e.scroller.updateHorizontalScrollSize(),e.updateVisibleHeight(),e.scroller.calcVisibleRows(),e.renderVisibleRows(),e.store.memorizePrevRowIndexesMap(),e.grouping=!1}};Object.assign(Grid.prototype,o)})(),(()=>{const{COLUMN_DRAGGING:e,ROW_GROUP_BAR:t,ROW_GROUP_BAR_EMPTY_TEXT:o,ROW_GROUP_BAR_ITEM_CONTAINER:r,ROW_GROUP_BAR_ITEM:l,ROW_GROUP_BAR_ITEM_TEXT:n,ROW_GROUP_BAR_ITEM_ACTIVE:s,SVG_ITEM:i,SVG_GROUP:a,SVG_DRAG:d,SVG_CHEVRON_RIGHT:c,SVG_REMOVE:u}=Fancy.cls,{div:p,span:h}=Fancy,g={renderRowGroupBar(){const e=this,r=p(t,{height:this.headerRowHeight+1+"px"}),l=Fancy.svg.group,n=h([i,a]);n.innerHTML=l,r.appendChild(n);const s=h([o]);s.innerHTML="Drag columns here to generate row groups",r.appendChild(s),e.gridEl.appendChild(r),e.rowGroupBarEmptyTextEl=s,e.rowGroupBarEl=r,e.renderRowGroupBarItems()},renderRowGroupBarItems(){const e=this;e.store.rowGroups.forEach((t=>{const o=e.getColumn(t);e.addGroupInBar(o,!1)})),delete e.activeRowGroupBarItemEl},onRowGroupBarMouseEnter(){this.addGroupInBar(this.columnDragging.column)},addGroupInBar(e,t=!0){const o=this,r=o.generateRowGroupBarItemEl(e);t&&r.classList.add(s),o.activeRowGroupBarItemEl=r,o.rowGroupBarItems=o.rowGroupBarItems||[],o.rowGroupBarItemColumns=o.rowGroupBarItemColumns||[],o.rowGroupBarEl.appendChild(r),o.rowGroupBarItems.push(r),o.rowGroupBarItemColumns.push(e),o.columnDragging&&"column"===o.rowGroupType&&o.rowGroupBarItemColumns.length<=1&&(o.$requiresReSetGroupColumn=!0),o.rowGroupBarEmptyTextEl.style.setProperty("display","none")},generateRowGroupBarItemEl(e){const t=this,o=p(r);o.setAttribute("row-group-order-index",String(t.rowGroupBarItems?.length||0));const s=h(l),a=h([i,d]);a.innerHTML=Fancy.svg.groupCellDrag,s.appendChild(a),a.addEventListener("mousedown",t.onRowGroupBarItemDragElMouseDown.bind(t));const g=h(n);g.innerHTML=e.title,s.appendChild(g);const m=h([i,u]);if(m.innerHTML=Fancy.svg.remove,m.addEventListener("click",t.onRowGroupBarItemRemoveClick.bind(t)),s.appendChild(m),t.rowGroupBarItems?.length){const e=Fancy.svg.chevronRight,r=h([i,c]);r.innerHTML=e,t.rowGroupBarSeparator&&o.appendChild(r)}return o.appendChild(s),o},onRowGroupBarItemDragElMouseDown(t){const o=this,l=t.target.closest(`.${r}`),n=Number(l.getAttribute("row-group-order-index")),i=o.rowGroupBarItemColumns[n];l.classList.add(s),o.activeRowGroupBarItemEl=l,o.isEditing&&o.hideActiveEditor(),o.columnDragging={column:i,inBar:!0,dragColumnCellEl:o.createDragColumnCellEl(i),rowGroupBarElRect:o.getRowGroupBarElRect(),dragItemFromRowGroupBar:!0,rowGroupBarItemsRect:o.getRowGroupBarItemsRect(),originalRowGroupItemOrderIndex:n},o.gridEl.classList.add(e),o.onColumnDragMouseMoveFn=o.onColumnDragMouseMove.bind(this),document.body.addEventListener("mousemove",o.onColumnDragMouseMoveFn),document.addEventListener("mouseup",(()=>{const t=o.columnDragging,{dragItemFromRowGroupBar:r,changedRowGroupItemOrderIndex:l,originalRowGroupItemOrderIndex:n,inBar:i}=o.columnDragging;r&&!i?(o.showColumn(t.column,!0),o.removeGroupInBar(t.column),setTimeout((()=>{o.reConfigRowGroups(),0===o.store.rowGroups.length&&o.$rowGroupColumn&&o.removeColumn(o.$rowGroupColumn)}),1)):(o.activeRowGroupBarItemEl.classList.remove(s),void 0!==l&&l!==n&&setTimeout((()=>{o.reConfigRowGroups()}),1)),o.gridEl.classList.remove(e),t?.dragColumnCellEl.remove(),delete o.columnDragMouseDownColumn,delete o.columnDragging,delete o.activeRowGroupBarItemEl,document.body.removeEventListener("mousemove",o.onColumnDragMouseMoveFn)}),{once:!0})},onRowGroupBarMouseLeave(){this.removeGroupInBar(this.columnDragging.column)},removeGroupInBar(e){const t=this;if(e){const o=t.rowGroupBarItemColumns.findIndex((t=>t.id===e.id)),r=t.rowGroupBarItems.splice(o,1)[0];t.rowGroupBarItemColumns.splice(o,1),r.remove(),t.reSetRowGroupOrderIndex()}else{const e=t.rowGroupBarItems.pop();t.rowGroupBarItemColumns.pop(),e.remove()}delete t.activeRowGroupBarItemEl,t.rowGroupBarItems&&0!==t.rowGroupBarItems?.length||t.rowGroupBarEmptyTextEl.style.setProperty("display","")},onRowGroupBarItemRemoveClick(e){const t=this,o=e.target.closest(`.${r}`),l=Number(o.getAttribute("row-group-order-index")),n=t.rowGroupBarItems.splice(l,1)[0],s=t.rowGroupBarItemColumns.splice(l,1)[0];t.isEditing&&t.hideActiveEditor(),n.remove(),t.showColumn(s,!0),delete t.activeRowGroupBarItemEl,t.rowGroupBarItems&&0!==t.rowGroupBarItems?.length||t.rowGroupBarEmptyTextEl.style.setProperty("display",""),t.reSetRowGroupOrderIndex(),t.reConfigRowGroups(),0===t.store.rowGroups.length&&t.$rowGroupColumn&&t.removeColumn(t.$rowGroupColumn)},reSetRowGroupOrderIndex(){this.rowGroupBarItems.forEach(((e,t)=>{e.getAttribute("row-group-order-index")!==String(t)&&e.setAttribute("row-group-order-index",t)}))},getRowGroupBarElRect(){const e=this.rowGroupBarEl.getBoundingClientRect();return{x:e.x,y:e.y,bottomX:e.x+e.width,rightY:e.y+e.height}},getRowGroupBarItemsRect(){const e=[];return this.rowGroupBarItems?.forEach((t=>{const o=t.getBoundingClientRect();e.push({x:o.x,y:o.y,rightX:o.x+o.width,bottomY:o.y+o.height})})),e},changeRowGroupBarItemOrder(e,t){const o=this,r=o.rowGroupBarItems[e],l=o.rowGroupBarItems[t],i=o.rowGroupBarItemColumns[e],a=o.rowGroupBarItemColumns[t];r.querySelector(`.${n}`).innerHTML=a.title,l.querySelector(`.${n}`).innerHTML=i.title,r.classList.remove(s),l.classList.add(s),o.activeRowGroupBarItemEl=l,o.columnDragging.rowGroupBarItemsRect=o.getRowGroupBarItemsRect(),o.columnDragging.changedRowGroupItemOrderIndex=t,o.rowGroupBarItemColumns[e]=a,o.rowGroupBarItemColumns[t]=i}};Object.assign(Grid.prototype,g)})(),(()=>{const{CELL:e,CELL_SELECTION:t,CELL_SELECTED:o,ACTIVE_CELL:r,ACTIVE_CELL_ROW:l,ROW:n,ROW_SELECTED:s,ROW_GROUP:i,ROW_GROUP_CELL_SELECTION:a,INPUT_CHECKBOX:d,BODY:c}=Fancy.cls,u={onRowCellSelectionClick(t){const o=this,r=t.target.closest(`.${e}`),l=Number(r.getAttribute("col-index")),i=r.closest(`.${n}`),a=i.getAttribute("row-id"),d=o.columns[l],c=o.store,u=c.idItemMap.get(a),p=!u.$selected,h=u.$rowGroupValue;c.selectRowItem(u,p),p?i.classList.add(s):i.classList.remove(s),d.headerCheckboxSelection&&o.updateHeaderCheckboxSelection(d),h&&o.updateRowGroupRowsAndCheckBoxes()},selectRow(e){const o=this,r=Number(e.getAttribute("col-index")),l=e.closest(`.${n}`),i=l.getAttribute("row-id"),a=o.columns[r],c=o.store,u=c.idItemMap.get(i),p=!u.$selected,h=u.$rowGroupValue,g=l.querySelectorAll(`div.${t} input.${d}`);c.selectRowItem(u,p),p?(l.classList.add(s),g.forEach((e=>{e.checked=!0}))):(l.classList.remove(s),g.forEach((e=>{e.checked=!1}))),a.headerCheckboxSelection&&o.updateHeaderCheckboxSelection(a),h&&o.updateRowGroupRowsAndCheckBoxes()},onRowGroupCellSelectionClick(e){const t=this,o=e.target.closest(`.${i}`),r=o.getAttribute("row-id"),l=t.store,n=l.idItemMap.get(r),a=!n.$selected,c=n.$rowGroupValue;l.selectGroupRowItems(n,a),a?o.classList.add(s):o.classList.remove(s),t.updateHeaderCheckboxesSelection(),l.groupsChildren[c].forEach((e=>{const o=t.bodyEl.querySelector(`[row-id="${e.id}"]`);if(!o)return;const r=o.querySelector(`.${d}`);a?(o.classList.add(s),r&&(r.checked=!0)):(o.classList.remove(s),r&&(r.checked=!1))})),c&&(t.updateRowGroupRowsAndCheckBoxes(),t.updateRowsAndCheckBoxes())},updateHeaderCheckboxesSelection(){const e=this;e.scroller.columnsViewRange.forEach((t=>{const o=e.columns[t];o.headerCheckboxSelection&&e.updateHeaderCheckboxSelection(o)}))},updateRowGroupRowsAndCheckBoxes(){const e=this.store;this.bodyEl.querySelectorAll(`.${i}`).forEach((t=>{const o=t.getAttribute("row-group").replaceAll("-","/").replaceAll("$","-"),r=t.querySelector(`.${a} .${d}`),l=e.groupDetails[o];if(l)switch(l.selectedStatus){case!1:t.classList.remove(s),r.indeterminate=!1,r.checked=!1;break;case"full":t.classList.add(s),r.checked=!0,r.indeterminate=!1;break;case"partly":t.classList.remove(s),r.indeterminate=!0}}))},updateRowsAndCheckBoxes(){const e=this.store;this.bodyEl.querySelectorAll(`.${n}`).forEach((o=>{const r=o.getAttribute("row-id"),l=e.idItemMap.get(r);l||console.error(`store.idItemMap does not contain ${r}`);const n=l.$selected,i=o.querySelector(`.${t} .${d}`);n?(o.classList.add(s),i&&(i.checked=!0)):(o.classList.remove(s),i&&(i.indeterminate=!1,i.checked=!1))}))},onBodyCellMouseDown(t){const o=this,r=t.target,l=r.closest(`.${e}`);if(o.hideActiveEditor(),Fancy.gridsMap.forEach((e=>{e.active=!1})),o.active=!0,o.activeCell){const e=()=>{o.setActiveCell(l),requestAnimationFrame((()=>{document.addEventListener("mousedown",(e=>{e.target.closest(`div.${c}`)||(o.clearActiveCell(),o.clearSelectionRange())}),{once:!0})}))};"checkbox"===r.getAttribute("type")?r.addEventListener("click",(()=>{e()}),{once:!0}):e()}o.selectingCells&&(o.isSelectingCells=!0,document.addEventListener("mouseup",(()=>{delete o.isSelectingCells}),{once:!0}))},onBodyCellMouseEnter(t){const o=this,r=t.target.closest(`.${e}`);if(!o.activeCell||void 0===o.activeCellColumnIndex||void 0===o.activeCellRowId||!0!==o.isSelectingCells)return;const l=Number(r.getAttribute("col-index")),s=r.closest(`.${n}`).getAttribute("row-id");o.secondActiveCell=r,o.secondActiveCellColumnIndex=l,o.secondActiveCellRowId=s,o.generateCellsSelectionRange(),o.selectCellsFromRange()},setShiftCellUp(){const e=this;if(!e.activeCell||void 0===e.activeCellColumnIndex||void 0===e.activeCellRowId)return;const t=e.store.idRowIndexesMap.get(e.secondActiveCellRowId),o=grid.store.getPrevVisibleRowIndex(t);if(void 0===o)return;const r=grid.store.getItemByRowIndex(o).id;e.secondActiveCell=e.getCell(o,e.secondActiveCellColumnIndex),e.secondActiveCellRowId=r,e.scrollToCell(e.secondActiveCell),e.generateCellsSelectionRange(),e.selectCellsFromRange()},setShiftCellDown(){const e=this;if(!e.activeCell||void 0===e.activeCellColumnIndex||void 0===e.activeCellRowId)return;const t=e.store.idRowIndexesMap.get(e.secondActiveCellRowId),o=grid.store.getNextVisibleRowIndex(t);if(void 0===o)return;const r=grid.store.getItemByRowIndex(o).id;e.secondActiveCell=e.getCell(o,e.secondActiveCellColumnIndex),e.secondActiveCellRowId=r,e.scrollToCell(e.secondActiveCell),e.generateCellsSelectionRange(),e.selectCellsFromRange()},setShiftCellLeft(){const e=this;if(!e.activeCell||void 0===e.activeCellColumnIndex||void 0===e.activeCellRowId)return;const t=e.getPrevVisibleColumnIndex(e.secondActiveCellColumnIndex),o=grid.store.idRowIndexesMap.get(e.secondActiveCellRowId);void 0!==t&&(e.secondActiveCellColumnIndex=t,e.secondActiveCell=e.getCell(o,t),e.scrollToCell(e.secondActiveCell),e.generateCellsSelectionRange(),e.selectCellsFromRange())},setShiftCellRight(){const e=this;if(!e.activeCell||void 0===e.activeCellColumnIndex||void 0===e.activeCellRowId)return;const t=e.getNextVisibleColumnIndex(e.secondActiveCellColumnIndex),o=grid.store.idRowIndexesMap.get(e.secondActiveCellRowId);void 0!==t&&(e.secondActiveCellColumnIndex=t,e.secondActiveCell=e.getCell(o,t),e.scrollToCell(e.secondActiveCell),e.generateCellsSelectionRange(),e.selectCellsFromRange())},clearActiveCell(){const e=this;e.activeCellEl?.classList.remove(r),e.activeCellRowEl?.classList.remove(l),delete e.activeCellEl,delete e.activeCellRowEl,delete e.activeCellColumnIndex,delete e.activeCellColumn,delete e.activeCellRowId},setActiveCell(e){const t=this,o=e.closest(`.${n}`),s=Number(t.activeCellRowEl?.getAttribute("row-index")),i=Number(o.getAttribute("row-index")),a=Number(e.getAttribute("col-index")),d=o.getAttribute("row-id"),c=t.columns[a];t.selectionCellsRange&&t.clearSelectionRange(),t.activeCellEl?.classList.remove(r),t.activeCellEl=e,t.activeCellEl.classList.add(r),t.activeCellRowEl?.classList.remove(l),t.activeCellRowEl=o,t.activeCellRowEl.classList.add(l),t.activeCellColumnIndex=a,t.activeCellColumn=c,t.activeCellRowId=d,t.secondActiveCell=e,t.secondActiveCellColumnIndex=a,t.secondActiveCellRowId=d;const u=t.bodyEl.getBoundingClientRect(),p=Fancy.getTranslateY(o),h=o.getBoundingClientRect();if(u.height+t.scroller.scrollTop<p+h.height){const e=i-s;t.scroller.deltaChange(-h.height*e)}else if(t.scroller.scrollTop>p){const e=s-i;t.scroller.deltaChange(e*h.height)}else if(u.width+t.scroller.scrollLeft<c.left+c.width){const e=c.left+c.width-(u.width+t.scroller.scrollLeft);t.scroller.horizontalDeltaChange(-e-t.scroller.scrollBarWidth-2)}else if(t.scroller.scrollLeft>c.left){const e=t.scroller.scrollLeft-c.left;t.scroller.horizontalDeltaChange(e+2)}},scrollToCell(e){const t=this,o=e.closest(`.${n}`),r=t.bodyEl.getBoundingClientRect(),l=Fancy.getTranslateY(o),s=o.getBoundingClientRect(),i=Number(e.getAttribute("col-index")),a=t.columns[i];if(r.height+t.scroller.scrollTop<l+s.height){const e=t.rowHeight;t.scroller.deltaChange(-e)}else if(t.scroller.scrollTop>l){const e=t.rowHeight;t.scroller.deltaChange(e)}else if(r.width+t.scroller.scrollLeft<a.left+a.width){const e=a.left+a.width-(r.width+t.scroller.scrollLeft);t.scroller.horizontalDeltaChange(-e-t.scroller.scrollBarWidth-2)}else if(t.scroller.scrollLeft>a.left){const e=t.scroller.scrollLeft-a.left;t.scroller.horizontalDeltaChange(e+2)}},hasActiveCell(){const e=this;return void 0!==e.activeCellColumn&&void 0!==e.activeCellRowId&&void 0!==e.activeCellColumnIndex},scrollToNotVisibleNewActiveCell(e,t){const o=this,r=o.scroller.scrollTop-(e-1)*o.rowHeight;o.$preventActiveCellRender=!0,o.scroller.deltaChange(r),setTimeout((()=>{const r=o.getCell(e,t);r&&o.setActiveCell(r)}),0)},setActiveCellUp(){const e=this,t=e.activeCellColumnIndex,o=e.activeCellRowEl,r=Number(o.getAttribute("row-index")),l=e.store.getPrevVisibleRowIndex(r);if(l===r||void 0===l)return void(void 0===l&&0!==e.scroller.scrollTop&&e.scroller.deltaChange(r*e.rowHeight));const n=e.getCell(l,t);n?e.setActiveCell(n):e.scrollToNotVisibleNewActiveCell(l,t)},setActiveCellDown(){const e=this,t=e.activeCellColumnIndex,o=e.activeCellRowEl,r=Number(o.getAttribute("row-index")),l=e.store.getDisplayedDataTotal(),n=e.store.getNextVisibleRowIndex(r);if(n===r||void 0===n){if(void 0===n){const t=l-r;e.scroller.deltaChange(-t*e.rowHeight)}return!1}const s=e.getCell(n,t);return s?e.setActiveCell(s):e.scrollToNotVisibleNewActiveCell(n,t),s},setActiveCellLeft(){const e=this,t=e.activeCellColumnIndex,o=e.getPrevVisibleColumnIndex(t),r=e.activeCellRowEl,l=Number(r.getAttribute("row-index"));if(o===t||void 0===o)return;const n=e.getCell(l,o);return n?e.setActiveCell(n):e.scrollToNotVisibleNewActiveCell(l,o),n},setActiveCellRight(){const e=this,t=e.activeCellRowEl,o=Number(t.getAttribute("row-index")),r=e.activeCellColumnIndex,l=e.getNextVisibleColumnIndex(r);if(l===r||void 0===l)return!1;const n=e.getCell(o,l);return n?e.setActiveCell(n):e.scrollToNotVisibleNewActiveCell(o,l),n},updateHeaderCheckboxSelection(e){const t=this.store,o=e.headerCheckboxSelectionEl,r=t.selectedItemsMap.size;r?t.getDataTotal()===r?(o.checked=!0,o.indeterminate=!1):o.indeterminate=!0:(o.indeterminate=!1,o.checked=!1)},onHeaderCheckboxSelectionClick(e){const t=this,o=t.store,r=e.target.checked;o.selectAll(r),o.rowGroups.length&&t.updateRowGroupRowsAndCheckBoxes(),t.updateRowsAndCheckBoxes()},getSelection(){const e=this.store,t=[];return e.selectedItemsMap.forEach((e=>{e.$isGroupRow||t.push(e)})),t},generateCellsSelectionRange(){const e=this,t=e.store.idRowIndexesMap.get(e.activeCellRowId),o=e.store.idRowIndexesMap.get(e.secondActiveCellRowId),r=[],l=[];t<=o?(r[0]=t,r[1]=o):(r[0]=o,r[1]=t),e.activeCellColumnIndex<=e.secondActiveCellColumnIndex?(l[0]=e.activeCellColumnIndex,l[1]=e.secondActiveCellColumnIndex):(l[0]=e.secondActiveCellColumnIndex,l[1]=e.activeCellColumnIndex),e.selectionCellsRange={rows:r,columns:l}},selectCellsFromRange(){const t=this;t.bodyEl.querySelectorAll(`div.${o}`).forEach((e=>{!1===t.isCellInSelectedRange(e)&&e.classList.remove(o)}));const{rows:r,columns:l}=t.selectionCellsRange;r[0]<t.scroller.startRow&&(r[0]=t.scroller.startRow),r[1]>t.scroller.endRow&&(r[1]=t.scroller.endRow),l[0]<t.scroller.columnViewStart&&(l[0]=t.scroller.columnViewStart),l[1]>t.scroller.columnViewEnd&&(l[1]=t.scroller.columnViewEnd);for(let s=r[0];s<=r[1];s++)for(let r=l[0];r<=l[1];r++){const l=t.bodyEl.querySelector(`div.${n}[row-index="${s}"] div.${e}[col-index="${r}"]`);l&&!l.classList.contains(o)&&l.classList.add(o)}},isCellInSelectedRange(e){const t=Number(e.getAttribute("col-index")),o=e.closest(`.${n}`);if(!o)return!1;const r=Number(o.getAttribute("row-index")),{rows:l,columns:s}=this.selectionCellsRange;return r>=l[0]&&r<=l[1]&&t>=s[0]&&t<=s[1]},clearSelectionRange(){this.bodyEl.querySelectorAll(`div.${o}`).forEach((e=>{e.classList.remove(o)})),delete this.selectionCellsRange},copySelectedCells(){const e=this.getTextFromSelectionRange();Fancy.copyText(e)},getTextFromSelectionRange(){const e=this,{rows:t,columns:o}=e.selectionCellsRange||{rows:[],columns:[]},r=[],l=e=>{const t=e.column,o=e.value;let r;if(t.getter)r=t.getter(e);else if(t.render)try{r=t.render(e)}catch(e){r=o}else r=o;return r};if(0===t.length&&e.activeCellEl){const t=e.activeCellEl.closest(`.${n}`);if(!t)return;const o=t.getAttribute("row-id"),r=e.store.idItemMap.get(o),s=Number(e.activeCellEl.getAttribute("col-index")),i=e.columns[s];return l({item:r,column:i,rowIndex:t.getAttribute("row-index"),columnIndex:s,value:r[i.index]})}for(let n=t[0];n<=t[1];n++){let t=e.store.getItemByRowIndex(n);const s=[];for(let r=o[0];r<=o[1];r++){const o=e.columns[r],i=l({item:t,column:o,rowIndex:n,columnIndex:r,value:t[o.index]});s.push(i)}r.push(s)}return r.map((e=>e.join("\t"))).join("\n")},insertCopiedCells(){const e=this,t=document.createElement("textarea");t.style.display="none",document.body.appendChild(t),t.focus();const o=(t,r=0)=>{const l=e.bodyEl.querySelector(`div[row-index="${t+r}"]`);return l&&l.classList.contains(i)?o(t,r+1):r};document.addEventListener("paste",(r=>{const l=r.clipboardData.getData("text");document.body.contains(t)&&document.body.removeChild(t);const s=l.split("\n").map((e=>e.split("\t"))),i=Number(e.activeCellRowEl.getAttribute("row-index"));let a=0;s.forEach(((t,r)=>{const l=o(i+r+a);a+=l;const s=i+r+a,d=e.store.getItemByRowIndex(s);if(!d)return;const c=e.bodyEl.querySelector(`.${n}[row-index="${s}"]`);let u=e.activeCellColumnIndex-1;t.forEach(((t,o)=>{u=e.getNextVisibleColumnIndex(u);const r=e.columns[u];if(!r||!r.editable)return;if(e.store.setById(d.id,r.index,t),!c||!r)return;let l=c.querySelector(`[col-index="${u}"]`);l?.remove(),l=e.createCell(s,u),c.appendChild(l)}))}))}))},setBlankForSelectedCells(){const e=this,{rows:t,columns:o}=e.selectionCellsRange||{rows:[],columns:[]},r=e=>{const t=e.column;let o=e.value;return t.setter&&(o=t.setter(e)),o};if(0===t.length&&e.activeCellEl){const t=e.activeCellEl.closest(`.${n}`);if(!t)return;const o=t.getAttribute("row-index"),l=t.getAttribute("row-id"),s=e.store.idItemMap.get(l),i=Number(e.activeCellEl.getAttribute("col-index")),a=e.columns[i],d=r({item:s,column:a,rowIndex:o,columnIndex:i,value:""});e.store.setById(l,a.index,d),e.activeCellEl.remove();const c=e.createCell(o,i);return t.appendChild(c),void(e.activeCellEl=c)}for(let l=t[0];l<=t[1];l++){const t=l;let s=e.store.getItemByRowIndex(l);const i=e.bodyEl.querySelector(`.${n}[row-index="${t}"]`);for(let l=o[0];l<=o[1];l++){const o=e.columns[l],n=l,a=r({item:s,column:o,rowIndex:t,columnIndex:n,value:""});if(e.store.setById(s.id,o.index,a),!i||!o)return;let d=i.querySelector(`[col-index="${n}"]`);d?.remove(),d=e.createCell(t,n),i.appendChild(d)}}}};Object.assign(Grid.prototype,u)})(),(()=>{const{DOWN:e,UP:t,LEFT:o,RIGHT:r,ESC:l,SPACE:n,C:s,V:i,ENTER:a,TAB:d,DELETE:c,BACKSPACE:u}=Fancy.key,{ROW:p}=Fancy.cls,h={initKeyNavigation(){document.body.addEventListener("keydown",this.onKeyDown.bind(this))},onKeyDown(h){const g=this;switch(h.keyCode){case s:(h.ctrlKey||h.metaKey)&&g.copySelectedCells();break;case i:g.activeCell&&g.activeCellEl&&(h.ctrlKey||h.metaKey)&&g.insertCopiedCells();break;case l:g.isEditing||g.destroyHeaderCellMenuList();break;case n:if(h.preventDefault(),g.activeCell&&g.activeCellEl){const e=g.activeCellEl,t=Number(e.getAttribute("col-index")),o=g.columns[t],r=e.closest(`.${p}`).getAttribute("row-id"),l=g.store.idItemMap.get(r)[o.index];"boolean"===o.type&&o.editable?(g.store.setById(r,o.index,!l),g.activeCellEl.querySelector("input").checked=!l):g.checkboxSelection&&g.selectRow(e)}break;case d:h.preventDefault(),g.onKeyTAB(h.shiftKey);break;case e:g.isEditing||(h.preventDefault(),g.onKeyDOWN(h.shiftKey));break;case t:g.isEditing||(h.preventDefault(),g.onKeyUP(h.shiftKey));break;case o:g.isEditing||g.onKeyLEFT(h.shiftKey);break;case r:g.isEditing||g.onKeyRIGHT(h.shiftKey);break;case a:g.isEditing||g.onKeyENTER();break;case u:case c:g.isEditing||g.setBlankForSelectedCells();break;default:const m=h.code;if(!g.activeEditor&&(m.startsWith("Key")&&4===m.length||m.startsWith("Digit")&&6===m.length)&&g.startEditByTyping&&g.hasActiveCell()){const e=g.activeCellEl,t=Number(e.getAttribute("col-index"));g.columns[t].editable&&(h.preventDefault(),g.openEditorForCell(g.activeCellEl,h.key))}}},onKeyUP(e){const t=this;t.active&&t.hasActiveCell()&&(e?t.setShiftCellUp():t.setActiveCellUp())},onKeyDOWN(e){const t=this;t.active&&t.hasActiveCell()&&(e?t.setShiftCellDown():t.setActiveCellDown())},onKeyLEFT(e){const t=this;t.active&&t.hasActiveCell()&&(e?t.setShiftCellLeft():t.setActiveCellLeft())},onKeyRIGHT(e){const t=this;t.active&&t.hasActiveCell()&&(e?t.setShiftCellRight():t.setActiveCellRight())},onKeyENTER(){const e=this;if(e.$preventOpeningEditor)delete e.$preventOpeningEditor;else if(e.activeCellEl){if(e.editingCell?.getAttribute("id")===e.activeCellEl.getAttribute("id"))return;e.openEditorForCell(e.activeCellEl)}},onKeyTAB(e){const t=this;t.active&&t.hasActiveCell()&&(t.isEditing?(t.hideActiveEditor(),(e?t.setActiveCellLeft():t.setActiveCellRight())&&t.openEditorForCell(t.activeCellEl)):e?t.setActiveCellLeft():t.setActiveCellRight())}};Object.assign(Grid.prototype,h)})(),(()=>{const{ANIMATE_CELLS_POSITION:e,COLUMN_DRAGGING:t,FAKE_COLUMN_CELL_DRAGGING:o,FAKE_COLUMN_CELL_DRAGGING_ALLOW:r,FAKE_COLUMN_CELL_DRAGGING_DENY:l,SVG_ITEM:n,SVG_BLOCK:s,SVG_GROUP:i,SVG_DRAG:a}=Fancy.cls,d=Fancy.span,c=Fancy.div,u={onColumnDragMouseMove(e){const o=this;if(o.columnDragging){const t=o.columnDragging,n=t.dragColumnCellEl,{pageX:s,pageY:i}=e;if(n.style.setProperty("left",s-10+"px"),n.style.setProperty("top",i-10+"px"),o.rowGroupBar&&o.isCursorInRowGroupBar(e,t.rowGroupBarElRect))if(t.inBar){const r=o.isCursorInAnotherRowGroupBarItem(e,t.rowGroupBarItemsRect),l=Number(o.activeRowGroupBarItemEl.getAttribute("row-group-order-index"));void 0!==r&&r!==l&&o.changeRowGroupBarItemOrder(l,r)}else{t.inBar=!0;let s=!1;o.rowGroupBarItemColumns?.forEach((e=>{e.title===t.column.title&&(s=!0)})),s&&!t.dragItemFromRowGroupBar||t.column.$isRowGroupColumn?(n.classList.add(l),n.classList.remove(r)):(n.classList.add(r),n.classList.remove(l),t.dragItemFromRowGroupBar||(o.onRowGroupBarMouseEnter(e),o.hideColumn(o.columnDragging.column,!0))),t.rowGroupBarItemsRect=o.getRowGroupBarItemsRect()}else t.inBar?(delete t.inBar,t.dragItemFromRowGroupBar?(n.classList.remove(r,l),n.classList.add(r)):(n.classList.contains(l)||(o.showColumn(t.column,!0),o.onRowGroupBarMouseLeave(e)),n.classList.remove(r,l))):(o.debouceColumnDraggingFn||(o.debouceColumnDraggingFn=Fancy.debounce(o.onColumnDragging,50)),o.debouceColumnDraggingFn(e))}else{o.isEditing&&o.hideActiveEditor();const r=Math.abs(e.pageX-o.columnDragDownX),l=Math.abs(e.pageY-o.columnDragDownY);if(r>o.deltaStartColumnDrag||l>o.deltaStartColumnDrag){const e=o.columnDragMouseDownColumn;o.columnDragging={column:e,dragColumnCellEl:o.createDragColumnCellEl(e)},o.rowGroupBar&&(o.columnDragging.rowGroupBarItemsRect=o.getRowGroupBarItemsRect()),o.gridEl.classList.add(t),o.rowGroupBar&&(o.columnDragging.rowGroupBarElRect=o.getRowGroupBarElRect())}}},createDragColumnCellEl(e){const t=c([o,"fg-theme-"+this.theme]),r=d(),l=e.title;r.innerHTML=l;const u=Fancy.svg.group,p=d([n,i]);p.innerHTML=u;const h=d([n,a]);h.innerHTML=Fancy.svg.groupCellDrag;const g=d([n,s]);return g.innerHTML=Fancy.svg.block,t.appendChild(g),t.appendChild(p),t.appendChild(h),t.appendChild(r),document.body.appendChild(t),t},isCursorInRowGroupBar:({pageX:e,pageY:t},o)=>e<o.bottomX&&e>o.x&&t<o.rightY&&t>o.y,isCursorInAnotherRowGroupBarItem({pageX:e},t){if(0!==t.length){for(let o=0,r=t.length;o<r;o++){const r=t[o];if(e>r.x&&e<r.rightX)return o}return e<t[0].x?0:e>t[t.length-1].rightX?t.length-1:void 0}},isCursorInAnotherColumn({pageX:e}){const t=this,o=t.headerEl.getBoundingClientRect(),r=t.scroller.columnsViewRange;e-=o.x;for(let o=0,l=r.length;o<l;o++){const l=r[o],n=t.columns[l];if(e>=n.left&&e<=n.left+n.width)return l}},onColumnDragging(e){const t=this;if(t.animatingColumnsPosition||t.activeRowGroupBarItemEl)return;const o=t.isCursorInAnotherColumn(e);if(void 0!==o&&t.columnDragMouseDownColumnIndex!==o){if("order"===t.columns[o]?.type)return;t.moveColumn(t.columnDragMouseDownColumnIndex,o),t.columnDragMouseDownColumnIndex=o}},moveColumn(t,o){const r=this;r.animatingColumnsPosition=!0,r.gridEl.classList.add(e);const l=r.columns.splice(t,1)[0];r.columns.splice(o,0,l);let n=[];if(r.reSetVisibleHeaderColumnsIndex(),t<o){for(let e=t,r=o;e<=r;e++)n.push(e);const e=n.shift();n.push(e),r.reSetVisibleBodyColumnsIndex(t,o,n)}else{for(let e=o,r=t;e<=r;e++)n.push(e);const e=n.pop();n.unshift(e),r.reSetVisibleBodyColumnsIndex(o,t,n)}r.scroller.generateNewRange(!1),r.reCalcColumnsPositions(),r.updateCellPositions(),setTimeout((()=>{r.gridEl.classList.remove(e),delete r.animatingColumnsPosition}),300)}};Object.assign(Grid.prototype,u)})(),(()=>{const{CELL:e,ROW:t,EDITING:o}=Fancy.cls,r={onBodyCellDBLClick(t){const o=t.target.closest(`.${e}`);this.openEditorForCell(o)},openEditorForCell(e,o){const r=this;let l=Number(e.getAttribute("col-index")),n=r.columns[l],s=e.closest(`.${t}`),i=s.getAttribute("row-id"),a=s.getAttribute("row-index"),d=r.store.idItemMap.get(i);const c=Fancy.getTranslateY(s);let u=d[n.index],p=u;if(!0!==n.editable)return void r.hideActiveEditor();if(n.getter){const t={item:d,column:n,rowIndex:a,columnIndex:l,value:u,cell:e};u=n.getter(t),p=u}const h=o=>{if(r.activeCellEl&&(e=r.activeCellEl,s=e.closest(`.${t}`),l=Number(e.getAttribute("col-index")),n=r.columns[l],a=s.getAttribute("row-index"),i=s.getAttribute("row-id"),d=r.store.idItemMap.get(i)),n.setter){const t={item:d,column:n,rowIndex:a,columnIndex:l,value:o,cell:e,newValue:o};n.setter(t)}else r.store.setById(i,n.index,o);if(e?.remove(),e=r.createCell(a,l),r.activeCellEl=e,s.appendChild(e),n.setter?r.rowCellsUpdateWithColumnIndex(s):r.rowCellsUpdateWithColumnRender(s),d.$rowGroupValue&&n.agFn){const e=d.$rowGroupValue.split("/");for(let t=0;t<e.length;t++){const o=e.slice(0,e.length-t).join("/");r.store.agGroupUpdateData(o,[d],"update"),r.updateRowGroupAggregations()}}};if(void 0!==o&&(u=o,h(u)),n.editorField)switch(n.type){case"string":case"number":case"date":r.setStatusEditing(!0),n.editorField.valueBeforeEdit=p,n.editorField.setValue(u),n.editorField.show({width:`${n.width}px`,left:`${n.left}px`,transform:`translateY(${c-1}px)`}),n.editorField.focus(),r.activeEditor=n.editorField}else switch(n.type){case"string":case"number":case"date":r.setStatusEditing(!0),n.editorField=new(Fancy[Fancy.capitalizeFirstLetter(`${n.type}Field`)])({renderTo:r.editorsContainerEl,valueBeforeEdit:p,value:u,style:{position:"absolute",width:`${n.width}px`,left:`${n.left}px`,transform:`translateY(${c-1}px)`,height:`${r.rowHeight+1}px`},onChange(e,t){!1!==t&&h(e)},onEnter(){r.hideActiveEditor();let e=!1;switch(r.editorEnterAction){case"down":e=r.setActiveCellDown();break;case"right":e=r.setActiveCellRight()}!1===e&&(r.$preventOpeningEditor=!0,setTimeout((()=>{delete r.$preventOpeningEditor}),100))},onESC(){h(this.valueBeforeEdit),r.hideActiveEditor()}}),n.editorField.focus(),r.activeEditor=n.editorField;break;default:r.hideActiveEditor()}},hideActiveEditor(){const e=this;e.activeEditor&&(e.activeEditor.hide(),delete e.activeEditor,e.setStatusEditing(!1))},setStatusEditing(e){const t=this;t.isEditing=e,e?(t.gridEl.classList.add(o),t.editingCell=t.activeCellEl):(t.gridEl.classList.remove(o),delete t.editingCell)},rowCellsUpdateWithColumnIndex(t){const o=this,r=t.getAttribute("row-index");t.querySelectorAll(`.${e}`).forEach((e=>{const l=Number(e.getAttribute("col-index"));void 0!==o.columns[l].index&&(e?.remove(),e=o.createCell(r,l),t.appendChild(e))}))},rowCellsUpdateWithColumnRender(t,o){const r=this,l=t.getAttribute("row-index"),n=t.getAttribute("row-id");t.querySelectorAll(`.${e}`).forEach((e=>{const s=Number(e.getAttribute("col-index")),i=r.columns[s];if(void 0===i.render||"order"===i.type||"id"===i.index)return;const a=r.createCell(l,s);if(e.innerHTML===a.innerHTML)return;e?.remove();const d=(e=a).style;o&&!e.style.backgroundColor&&(d.transition="background-color 2000ms",d.backgroundColor=r.flashChangesColors[r.store.selectedItemsMap.has(n)?1:0],setTimeout((()=>{d.backgroundColor=""})),setTimeout((()=>{d.transition="",d.backgroundColor=""}),2e3)),t.appendChild(e)}))},updateAfterAddRemove(){const e=this;e.scroller.calcMaxScrollTop(),e.scroller.updateScrollTop(),e.scroller.calcViewRange(),e.scroller.setVerticalSize(),e.scroller.updateHorizontalScrollSize(),e.updateVisibleHeight(),e.updateVisibleRowsAfterRemove(),e.store.memorizePrevRowIndexesMap(),e.updateHeaderCells()},updateVisibleRowsAfterRemove(){const e=this;requestAnimationFrame((()=>{requestAnimationFrame((()=>{e.renderedRowsIdMap.forEach(((t,o)=>{const r=e.store.idItemMap.get(o);e.actualRowsIdSet.has(r.id)&&e.updateRowPosition(r)}))}))}))},$processRowsToRemove(e){switch(Fancy.typeOf(e)){case"string":e=[{id:e}];break;case"object":e=[e];break;case"array":e=e.map((e=>"string"==typeof e?{id:e}:e))}return e}};Object.assign(Grid.prototype,r)})(),(()=>{const{FIELD:e,FIELD_INPUT:t}=Fancy.cls,{ENTER:o,ESC:r}=Fancy.key,{div:l,input:n}=Fancy;Fancy.Field=class{render(){const o=this,r=l(e,o.style);delete o.style,"string"==typeof o.renderTo&&(o.renderTo=document.getElementById(o.renderTo)),o.container=o.renderTo;const s=n(t);"date"===o.type&&(s.type="date"),s.value=o.value,o.input=s,r.appendChild(s),o.el=r,o.container.appendChild(r)}ons(){const e=this;e.input.addEventListener("input",e.onInput.bind(e)),e.input.addEventListener("keydown",e.onKeyDown.bind(e))}onInput(e){const t=e.target.value;this.onChange?.(t,!0)}onKeyDown(e){const t=this;switch(e.keyCode){case o:const l=e.target.value;t.onEnter?.(l);break;case r:t.onESC?.()}}setValue(e){this.input.value=e,this.onChange?.(e,!1)}focus(){this.input.focus()}hide(){this.el.style.display="none"}show(e){const t=this;t.el.style.display="";for(let o in e)t.el.style[o]=e[o]}}})(),(()=>{const{FILTER_FIELD:e,FILTER_FIELD_INPUT:t,FILTER_FIELD_SIGN:o,FILTER_FIELD_LIST_ITEM:r,FILTER_FIELD_LIST_ITEM_TEXT:l,FILTER_FIELD_LIST:n,FILTER_FIELD_TEXT:s}=Fancy.cls,i={Clear:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",Contains:"M19,10H5V8H19V10M19,16H5V14H19V16Z","Not Contains":"M21,10H9V8H21V10M21,16H9V14H21V16M4,5H6V16H4V5M6,18V20H4V18H6Z",Equals:"M 10.56 10 L 1.508 10 L 1.508 8 L 10.56 8 L 10.56 10 M 10.56 16 L 1.508 16 L 1.508 14 L 10.56 14 L 10.56 16 Z M 22.009 10.01 L 12.984 10.01 L 12.984 8.01 L 22.009 8.01 L 22.009 10.01 M 22.009 16.01 L 12.984 16.01 L 12.984 14.01 L 22.009 14.01 L 22.009 16.01 Z","Not Equals":"M 12.368 10 L 5.449 10 L 5.449 8 L 12.368 8 L 12.368 10 M 12.368 16 L 5.449 16 L 5.449 14 L 12.368 14 L 12.368 16 Z M 23.009 10.01 L 15.05 10.01 L 15.05 8.01 L 23.009 8.01 L 23.009 10.01 M 23.009 16.01 L 15.05 16.01 L 15.05 14.01 L 23.009 14.01 L 23.009 16.01 Z M 2.585 4.076 L 2.575 13.265 L 0.54 13.277 L 0.55 4.087 L 2.585 4.076 M 6.653 13.252 L 6.621 13.255 L 6.649 13.243 L 6.616 13.239 L 6.653 13.252 Z M 2.569 15.074 L 2.559 17.22 L 0.524 17.223 L 0.534 15.077 L 2.569 15.074 M 6.637 17.217 L 6.605 17.218 L 6.633 17.215 L 6.6 17.214 L 6.637 17.217 Z",Empty:"M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z","Not Empty":"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z","Starts with":"M11.14 4L6.43 16H8.36L9.32 13.43H14.67L15.64 16H17.57L12.86 4M12 6.29L14.03 11.71H9.96M4 18V15H2V20H22V18Z","Ends with":"M11.14 4L6.43 16H8.36L9.32 13.43H14.67L15.64 16H17.57L12.86 4M12 6.29L14.03 11.71H9.96M20 14V18H2V20H22V14Z",Regex:"M16,16.92C15.67,16.97 15.34,17 15,17C14.66,17 14.33,16.97 14,16.92V13.41L11.5,15.89C11,15.5 10.5,15 10.11,14.5L12.59,12H9.08C9.03,11.67 9,11.34 9,11C9,10.66 9.03,10.33 9.08,10H12.59L10.11,7.5C10.3,7.25 10.5,7 10.76,6.76V6.76C11,6.5 11.25,6.3 11.5,6.11L14,8.59V5.08C14.33,5.03 14.66,5 15,5C15.34,5 15.67,5.03 16,5.08V8.59L18.5,6.11C19,6.5 19.5,7 19.89,7.5L17.41,10H20.92C20.97,10.33 21,10.66 21,11C21,11.34 20.97,11.67 20.92,12H17.41L19.89,14.5C19.7,14.75 19.5,15 19.24,15.24V15.24C19,15.5 18.75,15.7 18.5,15.89L16,13.41V16.92H16V16.92M5,19A2,2 0 0,1 7,17A2,2 0 0,1 9,19A2,2 0 0,1 7,21A2,2 0 0,1 5,19H5Z","Greater Than":"M5.5,4.14L4.5,5.86L15,12L4.5,18.14L5.5,19.86L19,12L5.5,4.14Z","Less Than":"M18.5,4.14L19.5,5.86L8.97,12L19.5,18.14L18.5,19.86L5,12L18.5,4.14Z"},a={Clear:"=",Contains:"=","Not Contains":"!=",Equals:"==","Not Equals":"!==",Empty:"empty","Not Empty":"!empty","Starts with":"_a","Ends with":"a_",Regex:"regex","Greater Than":">","Less Than":"<",Positive:"+",Negative:"-"},d={"=":"Clear","=":"Contains","!=":"Not Contains","==":"Equals","!==":"Not Equals",empty:"Empty","!empty":"Not Empty",_a:"Starts with",a_:"Ends with",regex:"Regex",">":"Greater Than","<":"Less Than","+":"Positive","-":"Negative"},{div:c,input:u}=Fancy;Fancy.FilterField=class{sign="=";defaultSign="=";value="";constructor(e){const t=this;Object.assign(t,e),t.render(),t.ons()}render(){const r=this,l=c(e);r.container=r.renderTo;const n=c(o);n.innerHTML=['<svg width="17" height="17" viewBox="0 0 24 24" style="vertical-align: middle; fill: currentcolor;">','<path d=""></path>',"</svg>"].join(""),r.elSign=n;const i=u(t);i.value=r.value,r.input=i;const a=c(s);r.elText=a,r.updateUI(d[r.sign||r.defaultSign]),l.appendChild(n),l.appendChild(i),l.appendChild(a),r.container.appendChild(l)}ons(){const e=this;e.debouceInputFn=Fancy.debounce(e.onInput.bind(this),300),e.input.addEventListener("input",e.debouceInputFn),e.elSign.addEventListener("click",e.signClick.bind(this))}signClick(){const e=this;e.elComboList?e.destroyComboList():requestAnimationFrame((()=>{e.hideAllOpenedComboList(),e.showComboList()}))}onInput(e){const t=this,o=t.sign||t.defaultSign,r=e.target.value;t.onChange?.(r,o,t.column)}hideAllOpenedComboList(){document.body.querySelectorAll(`.${n}`).forEach((e=>{e.remove()}))}destroyComboList(){this.elComboList?.remove(),delete this.elComboList}showComboList(){const e=this,t=e.elSign.getBoundingClientRect(),o=t.top-1+t.height,s=t.left,a=c(n,{top:`${o}px`,left:`${s}px`});let d=[];switch(e.column.type){case"string":d=["Clear","Contains","Not Contains","Equals","Not Equals","Empty","Not Empty","Starts with","Ends with","Regex"];break;case"number":d=["Clear","Contains","Not Contains","Equals","Not Equals","Empty","Not Empty","Greater Than","Less Than","Positive","Negative"]}a.innerHTML=d.map((e=>{let t=[`<div sign="${e}" class="${r}">`];switch(t.push('<svg width="17" height="17" viewBox="0 0 24 24" style="vertical-align: middle; fill: currentcolor;">'),e){case"Clear":case"Contains":case"Not Contains":case"Equals":case"Not Equals":case"Empty":case"Not Empty":case"Starts with":case"Ends with":case"Regex":case"Greater Than":case"Less Than":t.push(`<path d="${i[e]}"></path>`),t.push("</svg>");break;case"Positive":t.pop(),t.push("&gt;0");break;case"Negative":t.pop(),t.push("&lt;0")}return t.push(`<div class="${l}">${e}</div>`),t.push("</div>"),t.join("")})).join(""),a.addEventListener("click",e.onListClick.bind(this)),document.body.appendChild(a),e.elComboList=a,e.onDocMouseDownFn=e.onDocMouseDown.bind(this),document.addEventListener("mousedown",e.onDocMouseDownFn)}onDocMouseDown(e){const t=this;e.target.closest(`.${n}`)||e.target.closest(`.${o}`)||(document.removeEventListener("mousedown",t.onDocMouseDownFn),t.destroyComboList())}onListClick(e){const t=this,o=e.target.closest(`.${r}`).getAttribute("sign");t.destroyComboList(),t.setSign(o),t.setValue("")}setValue(e){const t=this,o=t.sign||t.defaultSign;switch(o){case"empty":case"!empty":case"+":case"-":e=o;break;default:t.input.value=e}t.onChange?.(e,o,t.column)}setSign(e){this.sign=a[e],this.updateUI(e)}updateUI(e){const t=this;switch(e){case"Clear":case"Contains":case"Not Contains":case"Equals":case"Not Equals":case"Empty":case"Not Empty":case"Starts with":case"Ends with":case"Regex":case"Greater Than":case"Less Than":const o=t.elSign.querySelector("svg d"),r="Clear"===e?i.Contains:i[e];o?o.setAttribute("d",r):t.elSign.innerHTML=['<svg width="17" height="17" viewBox="0 0 24 24" style="vertical-align: middle; fill: currentcolor;">',`<path d="${r}"></path>`,"</svg>"].join("");break;case"Positive":t.elSign.innerHTML="&gt;0";break;case"Negative":t.elSign.innerHTML="&lt;0"}switch(e){case"Empty":case"Not Empty":case"Positive":case"Negative":t.input.style.display="none",t.elText.innerHTML=e,t.elText.style.display="block";break;default:t.input.style.display="",t.elText.style.display="none"}}}})(),(()=>{class e extends Fancy.Field{value="";type="string";constructor(e){super(e);const t=this;Object.assign(t,e),t.render(),t.ons()}}Fancy.StringField=e})(),(()=>{class e extends Fancy.Field{value="";type="number";constructor(e){super(e);const t=this;Object.assign(t,e),t.render(),t.ons()}}Fancy.NumberField=e})(),Fancy},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Fancy=t():e.Fancy=t();
